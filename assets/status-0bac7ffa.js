import{a1 as U,a2 as B,k as W,c as e,D as z,$ as O,G as E,a0 as H,X as x,S as _,B as V,H as y,a as p,N as I,U as q,ab as G,av as J,a3 as w,A as L,ar as K,as as A,at as F,au as $,aw as S,f as T,M as D,L as X,J as Q,ad as Y,ae as Z,af as ee,ag as te,ah as re,ak as ne,p as ae}from"./index-11c684f9.js";import{B as se,o as C,l as ie,p as oe,F as le,a as j,q as ce,f as ue,d as de,b as ge,r as me}from"./baseApiService-86e0c3b0.js";import{N as l}from"./networkState-0824194a.js";import{F as he}from"./input-6d1a0532.js";var pe=Object.defineProperty,fe=Object.getOwnPropertyDescriptor,ve=(t,r,c,u)=>{for(var s=u>1?void 0:u?fe(r,c):r,d=t.length-1,i;d>=0;d--)(i=t[d])&&(s=(u?i(r,c,s):i(s))||s);return u&&s&&pe(r,c,s),s};let M=class extends se{constructor(){const t=W().getNmsUdApiUrl();super(t)}async getRecordFromApi(t,r){const c=`status/${r}/${t}`;return this.get(c)}};M=ve([U()],M);const N=()=>B.get(M),Se=t=>e(y,{class:"status-tile",maxW:"350px",flex:1,get children(){return[e(z,{name:"StatusTile"}),e(O,{bg:"$loContrast",class:"status-tile",rounded:"$md",border:"1px solid $neutral7",shadow:"$lg",p:"$4",m:"$2",get children(){return[e(E,{name:"approval status icon",get src(){return t.imgUrl},mr:"$3"}),e(H,{alignItems:"flex-start",get children(){return[e(x,{size:"sm",fontWeight:"$medium",get children(){return t.name}}),e(x,{size:"sm",color:"$neutral11",get children(){return t.description}})]}}),e(_,{get when(){return t.actionText!=null},get children(){return e(V,{variant:"ghost",colorScheme:"accent",size:"sm",ml:"auto",get title(){return t.actionTooltipText},onClick:()=>t.onClick?.(),get children(){return t.actionText}})}})]}})]}}),be=Object.keys(C).map(t=>({title:ie(oe(t)),value:t})),P=j(ue(1),ce(Object.keys(C))),we=t=>e(le,{id:"segment",label:"From type",placeholder:"Select the form type",get value(){return t.value},options:be,get showValidationMessages(){return t.showValidationMessages},validation:r=>P(r),get onChange(){return t.onChange}}),xe=t=>{const[r,c]=p(""),[u,s]=p([]),[d,i]=p(l.Pending),[m,k]=p(!1),o=j(ge(10),de(50)),n=async(a,b)=>{const f=P(a),h=o(b);if(f.isValid==!1||h.isValid==!1){k(!0);return}i(l.Loading);const g=await N().getRecordFromApi(b,a[0]);if(g.isSuccess==!1){i(l.Error),q.show({status:"danger",title:"Failed to find anything",description:"Please ensure the details are correct and try again."});return}t.onFindItem(a[0],g.value),i(l.Success)};return[e(we,{get value(){return u()},get showValidationMessages(){return m()},onChange:s}),e(y,{m:20}),e(he,{id:"recordId",label:"Submission Id",placeholder:"rec_cmsf0i16rt8jls8rjqcg",get value(){return r()},get showValidationMessages(){return m()},validation:a=>o(a?.toString?.()),onChange:c}),e(y,{m:20}),e(I,{get children(){return e(V,{variant:"solid",get loading(){return d()===l.Loading},onClick:()=>n(u(),r()),children:"Search"})}})]};var ye=ae("<strong>Something went wrong");const $e=()=>{const{isOpen:t,onOpen:r,onClose:c}=G(),[u,s]=p([]),[d,i]=p(l.Loading);J(()=>{m()});const m=async()=>{const o=[];for(const n of Object.keys(C)){const a=n,b=w().getSubmissions(a),f=[],h=[];for(const g of b){if(h.filter(R=>R.value==g.value).length>0)continue;const v=await N().getRecordFromApi(g.value,n);if(v.isSuccess==!1){f.push(g.value);continue}h.push({title:v.value.name,value:v.value.id,image:v.value.iconUrl??L.fallbackImg,approvalStatus:v.value.approvalStatus})}if(f.length>0)for(const g of f)w().delSubmission(a,g);h.length<1||o.push({title:C[a],segment:a,items:h})}s(o),i(l.Success)},k=(o,n)=>{const a={title:n.name,value:n.id,image:n.iconUrl};w().addSubmission(o,a),i(l.Loading),m(),c()};return[e(K,{text:"Status"}),e(y,{m:25}),e(S,{maxW:"50em",mt:"3em",mb:"2em",class:"noselect",get children(){return e(A,{mt:"2em",status:"info",variant:"subtle",get children(){return[e(F,{mr:"$2_5"}),e($,{get children(){return e(x,{children:"All submissions need to be approved and then processed by our automated systems before they become visible for everyone else."})}})]}})}}),e(Q,{get fallback(){return e(S,{class:"noselect",get children(){return e(_,{get when(){return u().length>0},get fallback(){return e(S,{maxW:"50em",mt:"3em",mb:"2em",get children(){return e(A,{mt:"2em",status:"warning",variant:"subtle",justifyContent:"center",get children(){return[e(F,{mr:"$2_5"}),e($,{children:"No Items to display"})]}})}})},get children(){return e(T,{get each(){return u()},children:o=>e(S,{mb:"3em",get children(){return[e(x,{size:"2xl",textAlign:"center",get children(){return o.title}}),e(O,{class:"status-list",mt:"$2",flexWrap:"wrap",justifyContent:"center",get children(){return e(T,{get each(){return o.items},children:n=>e(Se,{get imgUrl(){return n.image??L.fallbackImg},get name(){return n.title??""},get description(){return me(n.approvalStatus)},actionText:"❌",actionTooltipText:"Click this to stop tracking the status of this submission",onClick:()=>{w().delSubmission(o.segment,n.value),i(l.Loading),m()}})})}})]}})})}})}})},get children(){return[e(D,{get when(){return d()===l.Loading},get children(){return e(I,{height:"25vh",get children(){return e(X,{})}})}}),e(D,{get when(){return d()===l.Error},get children(){return e(S,{maxW:"50em",mb:"2em",get children(){return e(A,{mt:"2em",status:"danger",variant:"subtle",get children(){return[e(F,{mr:"$2_5"}),e($,{get children(){return[ye(),": Please refresh the page to try again. If the problem persists, please reach out to us on the NMSUD Discord"]}})]}})}})}})]}}),e(I,{get children(){return e(V,{onClick:r,children:"Add new submission to track"})}}),e(ne,{get opened(){return t()},onClose:c,get children(){return[e(Y,{}),e(Z,{get children(){return[e(ee,{}),e(te,{children:"Track form submission"}),e(re,{pb:"2em",get children(){return e(xe,{onFindItem:k})}})]}})]}})]};export{$e as StatusPage,$e as default};
