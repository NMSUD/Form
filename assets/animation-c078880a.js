import{al as ae,ac as $,a1 as ct,k as Z,a2 as lt,am as Nt,an as st,a3 as Ce,ao as xa,c as g,Y as lr,G as Ca,a0 as $a,X as De,B as Ue,$ as kt,ap as xr,ab as Ea,D as Cr,ad as Oa,ae as Ra,af as Da,ag as Ua,ah as Fa,ak as Va,a as dt,aq as ur,ar as Wa,as as La,at as qa,au as za,S as ht,f as Ga,N as Ha,C as dr,m as hr,T as Xa,R as ja,aj as Ka,p as Qa,U as te,A as Ya}from"./index-c7dd3975.js";import{N as j}from"./networkState-0824194a.js";import{m as Ae,d as fe,n as Y,A as Ja,s as Ht,a as F,e as Xt,f as le,v as Ve,g as nt,b as J,h as mr,B as $r,i as Er,j as Za,k as es,l as pr}from"./baseApiService-d18e1844.js";import{F as ue}from"./form-ee898103.js";import{f as jt,i as Or,a as ts}from"./input-dd7b6235.js";import{F as rs,G as as,a as ss}from"./grid-dbfa805a.js";import{B as ns}from"./bugReportForm-782674f1.js";const zo={Builders:["Youtuber","Twitch Streamer"],BuildingTechniques:["Survival","Creative","Glitch","Mods","Save editing","Blender"],Community:["Alliance","Civilization","Federation","Hub"]},W=async(t,e)=>[`**${t}**: ${e}`],Rr=t=>async(e,r)=>[`**${e}**: [${t}](${r})`],pe=async(t,e)=>[`**${t}**: ${Ae(e).join(", ")}`],is=async(t,e)=>[`**${t}**: ${Ae(e).map((r,a)=>`[Image${a+1}](${r})`).join(", ")}`],os=async(t,e)=>[`**${t}**: ${jt(e,"DD MMM YY")}`],Dr=t=>async(e,r)=>{const a=[];for(const s of r){const n=await t.dbCall(s);if(n.isSuccess==!1){a.push("**error**");continue}const i=t.mapValue(n.value);a.push(i)}return[`**${e}**: ${Ae(a).join(", ")}`]},cs=500,Kt={label:"Contact Details (only visible to NMSUD organisers)",helpText:"This is so that we can get in contact with you if there are any issue with your submissions, etc.",defaultValue:"",discord:{label:"Contact Details",display:W},validator:fe(cs)},Qt={label:"anonymousUserGuid",defaultValue:"",discord:{display:W},validator:Y},Ur=5,fr=12;var $e=(t=>(t[t.PSX=0]="PSX",t[t.XBX=1]="XBX",t[t.Steam=2]="Steam",t[t.Apple=3]="Apple",t))($e||{});const ls=t=>{switch(t){case 0:return"Playstation";case 1:return"Xbox";case 2:return"Steam";case 3:return"Apple"}return"Unknown"},Go=t=>{const r={[$e[0]]:0,[$e[1]]:1,[$e[2]]:2,[$e[3]]:3,[0 .toString()]:0,[1 .toString()]:1,[2 .toString()]:2,[3 .toString()]:3}[t];return r??2},xe=t=>({table:t.repo,create:async e=>{try{return{isSuccess:!0,value:await t.repo.create({...e,approvalStatus:Ja.pending,...ae}),errorMessage:""}}catch(r){const a=`error occurred while reading record from database. ex: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:ae,errorMessage:a}}},read:async e=>{try{const r=await t.repo.read(e);if(r==null)throw`read${t.logName} - Record not found for (${e})`;return{isSuccess:!0,value:r,errorMessage:""}}catch(r){const a=`error occurred while creating record in database. ex: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:ae,errorMessage:a}}},readAll:async()=>{try{return{isSuccess:!0,value:await t.repo.getAll(),errorMessage:""}}catch(e){const r=`error occurred while fetching all records in database. ex: ${e?.toString?.()}`;return $().e(r),{isSuccess:!1,value:ae,errorMessage:r}}},update:async(e,r)=>{try{return await t.repo.update(e,{...r,...ae}),{isSuccess:!0,errorMessage:""}}catch(a){const s=`error occurred while updating record in database. ex: ${a?.toString?.()}`;return $().e(s),{isSuccess:!1,errorMessage:s}}}}),us=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.filter({"builder.id":e}).select(["id","builder.id","builder.name","builder.profilePicUrl","community.id","community.name","community.profilePicUrl"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getCommunityBuilderRecordByBuilderId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:[],errorMessage:a}}},ds=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.filter({"community.id":e}).select(["id","builder.id","builder.name","builder.profilePicUrl","community.id","community.name","community.profilePicUrl"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getCommunityBuilderRecordByCommunityId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:[],errorMessage:a}}},hs=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.summarize({summaries:{numBuilders:{count:"*"}},filter:{"community.id":e}})).summaries[0].numBuilders,errorMessage:""}}catch(r){const a=`getNumberOfBuildersByCommunityId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:-1,errorMessage:a}}},ms=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.filter({"builder.id":e}).select(["id","builder.id","builder.name","planetBuild.id","planetBuild.name"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getPlanetBuildByBuilderId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:[],errorMessage:a}}},ps=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.filter({"planetBuild.id":e}).select(["id","builder.id","builder.name","planetBuild.id","planetBuild.name"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getPlanetBuildByPlanetBuildId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:[],errorMessage:a}}},fs=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.summarize({summaries:{numBuilds:{count:"*"}},filter:{"builder.id":e}})).summaries[0].numBuilds,errorMessage:""}}catch(r){const a=`getNumberOfBuildsByBuilderId: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,value:-1,errorMessage:a}}},Fr=async(t,e,r)=>await e({name:t,setAttributes:()=>{}}),z={KIND:"xata.trace.kind",VERSION:"xata.sdk.version",TABLE:"xata.table",HTTP_REQUEST_ID:"http.request_id",HTTP_STATUS_CODE:"http.status_code",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_USER_AGENT:"http.user_agent",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_ROUTE:"http.route",HTTP_TARGET:"http.target",CLOUDFLARE_RAY_ID:"cf.ray"};function Vr(t){return t!=null}function ne(t){return t.filter(Vr)}function Wr(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>Vr(e)))}function Yt(t){try{return t instanceof Blob}catch{return!1}}function b(t){return!!t&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof Date)&&!Yt(t)}function A(t){return t!=null}function k(t){return A(t)&&typeof t=="string"}function Lr(t){return A(t)&&Array.isArray(t)&&t.every(k)}function qr(t){return A(t)&&typeof t=="number"}function gs(t){if(qr(t))return t;if(k(t)){const e=Number(t);if(!Number.isNaN(e))return e}}function bs(t){try{return btoa(t)}catch{return Buffer.from(t).toString("base64")}}function zr(t,e){const r={...t};for(const[a,s]of Object.entries(e))b(s)&&b(r[a])?r[a]=zr(r[a],s):r[a]=s;return r}function Jt(t,e){const r=[];for(let a=0;a<t.length;a+=e)r.push(t.slice(a,a+e));return r}async function ys(t){return new Promise(e=>setTimeout(e,t))}function ws(t){let e;const r=new Promise(a=>{e=setTimeout(()=>{a()},t)});return{cancel:()=>clearTimeout(e),promise:r}}function Zt(t,e){const r=(a,s)=>a.then(n=>e(s).then(i=>(n.push(i),n)));return t.reduce(r,Promise.resolve([]))}function ut(){try{if(A(process)&&A(process.env))return{apiKey:{}.XATA_API_KEY??mt(),databaseURL:{}.XATA_DATABASE_URL??pt(),branch:{}.XATA_BRANCH??ft(),deployPreview:{}.XATA_PREVIEW,deployPreviewBranch:{}.XATA_PREVIEW_BRANCH,vercelGitCommitRef:{}.VERCEL_GIT_COMMIT_REF,vercelGitRepoOwner:{}.VERCEL_GIT_REPO_OWNER}}catch{}try{if(b(Deno)&&b(Deno.env))return{apiKey:Deno.env.get("XATA_API_KEY")??mt(),databaseURL:Deno.env.get("XATA_DATABASE_URL")??pt(),branch:Deno.env.get("XATA_BRANCH")??ft(),deployPreview:Deno.env.get("XATA_PREVIEW"),deployPreviewBranch:Deno.env.get("XATA_PREVIEW_BRANCH"),vercelGitCommitRef:Deno.env.get("VERCEL_GIT_COMMIT_REF"),vercelGitRepoOwner:Deno.env.get("VERCEL_GIT_REPO_OWNER")}}catch{}return{apiKey:mt(),databaseURL:pt(),branch:ft(),deployPreview:void 0,deployPreviewBranch:void 0,vercelGitCommitRef:void 0,vercelGitRepoOwner:void 0}}function vs(){try{if(b(process)&&b(process.env)&&{}.XATA_ENABLE_BROWSER!==void 0)return{}.XATA_ENABLE_BROWSER==="true"}catch{}try{if(b(Deno)&&b(Deno.env)&&Deno.env.get("XATA_ENABLE_BROWSER")!==void 0)return Deno.env.get("XATA_ENABLE_BROWSER")==="true"}catch{}try{return XATA_ENABLE_BROWSER===!0||XATA_ENABLE_BROWSER==="true"}catch{return}}function mt(){try{return XATA_API_KEY}catch{return}}function pt(){try{return XATA_DATABASE_URL}catch{return}}function ft(){try{return XATA_BRANCH}catch{return}}function Bs(){try{const{databaseURL:t}=ut();return t}catch{return}}function Ss(){try{const{apiKey:t}=ut();return t}catch{return}}function Ns(){try{const{branch:t}=ut();return t}catch{return}}function ks({org:t,branch:e}){return`preview-${t}-${e}`}function Ts(){try{const{deployPreview:t,deployPreviewBranch:e,vercelGitCommitRef:r,vercelGitRepoOwner:a}=ut();if(e)return e;switch(t){case"vercel":{if(!r||!a){console.warn("XATA_PREVIEW=vercel but VERCEL_GIT_COMMIT_REF or VERCEL_GIT_REPO_OWNER is not valid");return}return ks({org:a,branch:r})}}return}catch{return}}var er=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Se=(t,e,r)=>(er(t,e,"read from private field"),r?r.call(t):e.get(t)),Ge=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},gt=(t,e,r,a)=>(er(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),_s=(t,e,r)=>(er(t,e,"access private method"),r),Ee,ke,it,Tt,Gr;const Is=5*60*1e3;function As(t){const e=typeof fetch<"u"?fetch:void 0,r=typeof globalThis<"u"?globalThis.fetch:void 0,a=t??e??r;if(!a)throw new Error("Couldn't find a global `fetch`. Pass a fetch implementation explicitly.");return a}class Ps{constructor(e=10){Ge(this,Tt),Ge(this,Ee,void 0),Ge(this,ke,void 0),Ge(this,it,void 0),gt(this,ke,[]),gt(this,it,e),this.running=0,this.started=0}setFetch(e){gt(this,Ee,e)}getFetch(){if(!Se(this,Ee))throw new Error("Fetch not set");return Se(this,Ee)}request(e,r){const a=new Date,s=this.getFetch(),n=async(i=!1)=>{const{promise:o,cancel:c}=ws(Is),l=await Promise.race([s(e,r),o.then(()=>null)]).finally(c);if(!l)throw new Error("Request timed out");if(l.status===429){const w=gs(l.headers?.get("x-ratelimit-reset"))??1;return await ys(w*1e3),await n(!0)}if(i){const w=new Date().getTime()-a.getTime();console.warn(`A request to Xata hit branch rate limits, was retried and stalled for ${w}ms`)}return l};return _s(this,Tt,Gr).call(this,async()=>await n())}}Ee=new WeakMap;ke=new WeakMap;it=new WeakMap;Tt=new WeakSet;Gr=function(t){const e=new Promise(r=>Se(this,ke).push(r)).finally(()=>{this.started--,this.running++}).then(()=>t()).finally(()=>{this.running--;const r=Se(this,ke).shift();r!==void 0&&(this.started++,r())});if(this.running+this.started<Se(this,it)){const r=Se(this,ke).shift();r!==void 0&&(this.started++,r())}return e};function We(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}async function Ms(t,e){const r=t.getReader();let a;for(;!(a=await r.read()).done;)e(a.value)}function xs(t){let e,r,a,s=!1;return function(i){e===void 0?(e=i,r=0,a=-1):e=$s(e,i);const o=e.length;let c=0;for(;r<o;){s&&(e[r]===10&&(c=++r),s=!1);let l=-1;for(;r<o&&l===-1;++r)switch(e[r]){case 58:a===-1&&(a=r-c);break;case 13:s=!0;case 10:l=r;break}if(l===-1)break;t(e.subarray(c,l),a),c=r,a=-1}c===o?e=void 0:c!==0&&(e=e.subarray(c),r-=c)}}function Cs(t,e,r){let a=gr();const s=new TextDecoder;return function(i,o){if(i.length===0)r?.(a),a=gr();else if(o>0){const c=s.decode(i.subarray(0,o)),l=o+(i[o+1]===32?2:1),w=s.decode(i.subarray(l));switch(c){case"data":a.data=a.data?a.data+`
`+w:w;break;case"event":a.event=w;break;case"id":t(a.id=w);break;case"retry":const h=parseInt(w,10);isNaN(h)||e(a.retry=h);break}}}}function $s(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function gr(){return{data:"",event:"",id:"",retry:void 0}}const _t="text/event-stream",br="last-event-id";function Es(t,{signal:e,headers:r,onopen:a,onmessage:s,onclose:n,onerror:i,fetch:o,...c}){return new Promise((l,w)=>{const h={...r};h.accept||(h.accept=_t);let v;function P(){v.abort()}e?.addEventListener("abort",()=>{P(),l()});const x=o??fetch,M=a??Os;async function p(){v=new AbortController;try{const f=await x(t,{...c,headers:h,signal:v.signal});await M(f),await Ms(f.body,xs(Cs(B=>{B?h[br]=B:delete h[br]},B=>{},s))),n?.(),P(),l()}catch{}}p()})}function Os(t){const e=t.headers?.get("content-type");if(!e?.startsWith(_t))throw new Error(`Expected content-type to be ${_t}, Actual: ${e}`)}const tr="0.28.4";class Rs extends Error{constructor(e,r){super(e,r)}}class bt extends Rs{constructor(e,r,a){super(yr(r)),this.status=e,this.errors=Hr(r)?r.errors:[{message:yr(r),status:e}],this.requestId=a,r instanceof Error&&(this.stack=r.stack,this.cause=r.cause)}toString(){const e=super.toString();return`[${this.status}] (${this.requestId??"Unknown"}): ${e}`}}function Hr(t){return b(t)&&Array.isArray(t.errors)}function Ds(t){return b(t)&&k(t.message)}function yr(t){return t instanceof Error?t.message:k(t)?t:Ds(t)?t.message:Hr(t)?"Bulk operation failed":"Unexpected error"}const Us={production:{main:"https://api.xata.io",workspaces:"https://{workspaceId}.{region}.xata.sh"},staging:{main:"https://api.staging-xata.dev",workspaces:"https://{workspaceId}.{region}.staging-xata.dev"},dev:{main:"https://api.dev-xata.dev",workspaces:"https://{workspaceId}.{region}.dev-xata.dev"},local:{main:"http://localhost:6001",workspaces:"http://{workspaceId}.{region}.localhost:6001"}};function Fs(t){return k(t)&&Object.keys(Us).includes(t)}function Vs(t){if(!k(t))return null;const e={production:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.xata\.sh.*/),staging:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.staging-xata\.dev.*/),dev:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.dev-xata\.dev.*/),local:t.match(/(?:https?:\/\/)?([^.]+)(?:\.([^.]+))\.localhost:(\d+)/)},[r,a]=Object.entries(e).find(([,s])=>s!==null)??[];return!Fs(r)||!a?null:{workspace:a[1],region:a[2],host:r}}const wr=new Ps,It=(t,e={},r={})=>{const a=Object.entries(e).reduce((o,[c,l])=>l==null?o:{...o,[c]:l},{}),s=new URLSearchParams(a).toString(),n=s.length>0?`?${s}`:"",i=Object.entries(r).reduce((o,[c,l])=>({...o,[c]:encodeURIComponent(String(l??"")).replace("%3A",":")}),{});return t.replace(/\{\w*\}/g,o=>i[o.slice(1,-1)])+n};function Xr({method:t,endpoint:e,path:r,workspacesApiUrl:a,apiUrl:s,pathParams:n={}}){if(e==="dataPlane"){let i=k(a)?`${a}${r}`:a(r,n);if(t.toUpperCase()==="PUT"&&["/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file","/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}"].includes(r)){const{host:c}=Vs(i)??{};switch(c){case"production":i=i.replace("xata.sh","upload.xata.sh");break;case"staging":i=i.replace("staging-xata.dev","upload.staging-xata.dev");break;case"dev":i=i.replace("dev-xata.dev","upload.dev-xata.dev");break}}const o=k(n.workspace)?i.replace("{workspaceId}",String(n.workspace)):i;return k(n.region)?o.replace("{region}",String(n.region)):o}return`${s}${r}`}function Ws(t){const e=/.*:\/\/(?<host>[^/]+).*/,{groups:r}=e.exec(t)??{};return r?.host?{Host:r.host}:{}}async function Ls(t,e){if(!A(t))return;if(Yt(t)||typeof t.text=="function")return t;const{"Content-Type":r}=e??{};return String(r).toLowerCase()==="application/json"&&b(t)?JSON.stringify(t):t}const jr=We();async function Kr({url:t,method:e,body:r,headers:a,pathParams:s,queryParams:n,fetch:i,apiKey:o,endpoint:c,apiUrl:l,workspacesApiUrl:w,trace:h,signal:v,clientID:P,sessionID:x,clientName:M,xataAgentExtra:p,fetchOptions:f={},rawResponse:B=!1}){return wr.setFetch(i),await h(`${e.toUpperCase()} ${t}`,async({setAttributes:T})=>{const _=Xr({method:e,endpoint:c,path:t,workspacesApiUrl:w,pathParams:s,apiUrl:l}),V=It(_,n,s),ee=V.includes("localhost")?V.replace(/^[^.]+\.[^.]+\./,"http://"):V;T({[z.HTTP_URL]:ee,[z.HTTP_TARGET]:It(t,n,s)});const Me=ne([["client","TS_SDK"],["version",tr],A(M)?["service",M]:void 0,...Object.entries(p??{})]).map(([be,Ma])=>`${be}=${Ma}`).join("; "),L=Wr({"Accept-Encoding":"identity","Content-Type":"application/json","X-Xata-Client-ID":P??jr,"X-Xata-Session-ID":x??We(),"X-Xata-Agent":Me,...a,...Ws(V),Authorization:`Bearer ${o}`}),q=await wr.request(ee,{...f,method:e.toUpperCase(),body:await Ls(r,L),headers:L,signal:v}),{host:Aa,protocol:Pa}=zs(q.url),ze=q.headers?.get("x-request-id")??void 0;T({[z.KIND]:"http",[z.HTTP_REQUEST_ID]:ze,[z.HTTP_STATUS_CODE]:q.status,[z.HTTP_HOST]:Aa,[z.HTTP_SCHEME]:Pa?.replace(":",""),[z.CLOUDFLARE_RAY_ID]:q.headers?.get("cf-ray")??void 0});const cr=q.headers?.get("x-xata-message");if(cr&&console.warn(cr),q.status===204)return{};if(q.status===429)throw new bt(q.status,"Rate limit exceeded",ze);try{const be=B?await q.blob():await q.json();if(q.ok)return be;throw new bt(q.status,be,ze)}catch(be){throw new bt(q.status,be,ze)}},{[z.HTTP_METHOD]:e.toUpperCase(),[z.HTTP_ROUTE]:t})}function qs({url:t,method:e,body:r,headers:a,pathParams:s,queryParams:n,fetch:i,apiKey:o,endpoint:c,apiUrl:l,workspacesApiUrl:w,onMessage:h,onError:v,onClose:P,signal:x,clientID:M,sessionID:p,clientName:f,xataAgentExtra:B}){const T=Xr({method:e,endpoint:c,path:t,workspacesApiUrl:w,pathParams:s,apiUrl:l}),_=It(T,n,s),V=_.includes("localhost")?_.replace(/^[^.]+\./,"http://"):_;Es(V,{method:e,body:JSON.stringify(r),fetch:i,signal:x,headers:{"X-Xata-Client-ID":M??jr,"X-Xata-Session-ID":p??We(),"X-Xata-Agent":ne([["client","TS_SDK"],["version",tr],A(f)?["service",f]:void 0,...Object.entries(B??{})]).map(([ee,Me])=>`${ee}=${Me}`).join("; "),...a,Authorization:`Bearer ${o}`,"Content-Type":"application/json"},onmessage(ee){h?.(JSON.parse(ee.data))},onerror(ee){v?.(JSON.parse(ee.data))},onclose(){P?.()}})}function zs(t){try{const{host:e,protocol:r}=new URL(t);return{host:e,protocol:r}}catch{return{}}}const d=async t=>Kr({...t,endpoint:"dataPlane"}),Gs=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/apply",method:"post",...t,signal:e}),Hs=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/status",method:"get",...t,signal:e}),Xs=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/jobs/{jobId}",method:"get",...t,signal:e}),js=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/migrations",method:"get",...t,signal:e}),Ks=(t,e)=>d({url:"/dbs/{dbName}",method:"get",...t,signal:e}),rr=(t,e)=>d({url:"/db/{dbBranchName}",method:"get",...t,signal:e}),Qs=(t,e)=>d({url:"/db/{dbBranchName}",method:"put",...t,signal:e}),Ys=(t,e)=>d({url:"/db/{dbBranchName}",method:"delete",...t,signal:e}),Js=(t,e)=>d({url:"/db/{dbBranchName}/schema",method:"get",...t,signal:e}),Zs=(t,e)=>d({url:"/db/{dbBranchName}/copy",method:"post",...t,signal:e}),en=(t,e)=>d({url:"/db/{dbBranchName}/metadata",method:"put",...t,signal:e}),tn=(t,e)=>d({url:"/db/{dbBranchName}/metadata",method:"get",...t,signal:e}),rn=(t,e)=>d({url:"/db/{dbBranchName}/stats",method:"get",...t,signal:e}),an=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"get",...t,signal:e}),sn=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"post",...t,signal:e}),nn=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"delete",...t,signal:e}),on=(t,e)=>d({url:"/dbs/{dbName}/resolveBranch",method:"get",...t,signal:e}),cn=(t,e)=>d({url:"/db/{dbBranchName}/migrations",method:"get",...t,signal:e}),ln=(t,e)=>d({url:"/db/{dbBranchName}/migrations/plan",method:"post",...t,signal:e}),un=(t,e)=>d({url:"/db/{dbBranchName}/migrations/execute",method:"post",...t,signal:e}),dn=(t,e)=>d({url:"/dbs/{dbName}/migrations/query",method:"post",...t,signal:e}),hn=(t,e)=>d({url:"/dbs/{dbName}/migrations",method:"post",...t,signal:e}),mn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}",method:"get",...t,signal:e}),pn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}",method:"patch",...t,signal:e}),fn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/commits",method:"post",...t,signal:e}),gn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/compare",method:"post",...t,signal:e}),bn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/merge",method:"get",...t,signal:e}),yn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/merge",method:"post",...t,signal:e}),wn=(t,e)=>d({url:"/db/{dbBranchName}/schema/history",method:"post",...t,signal:e}),vn=(t,e)=>d({url:"/db/{dbBranchName}/schema/compare",method:"post",...t,signal:e}),Bn=(t,e)=>d({url:"/db/{dbBranchName}/schema/compare/{branchName}",method:"post",...t,signal:e}),Sn=(t,e)=>d({url:"/db/{dbBranchName}/schema/update",method:"post",...t,signal:e}),Nn=(t,e)=>d({url:"/db/{dbBranchName}/schema/preview",method:"post",...t,signal:e}),kn=(t,e)=>d({url:"/db/{dbBranchName}/schema/apply",method:"post",...t,signal:e}),Tn=(t,e)=>d({url:"/db/{dbBranchName}/schema/push",method:"post",...t,signal:e}),_n=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"put",...t,signal:e}),In=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"delete",...t,signal:e}),An=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"patch",...t,signal:e}),Pn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/schema",method:"get",...t,signal:e}),Mn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/schema",method:"put",...t,signal:e}),xn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns",method:"get",...t,signal:e}),Cn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns",method:"post",...t,signal:e}),$n=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"get",...t,signal:e}),En=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"patch",...t,signal:e}),On=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"delete",...t,signal:e}),Le=(t,e)=>d({url:"/db/{dbBranchName}/transaction",method:"post",...t,signal:e}),Qr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data",method:"post",...t,signal:e}),Yr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"get",...t,signal:e}),Jr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"put",...t,signal:e}),Zr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"delete",...t,signal:e}),Rn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"get",...t,signal:e}),Dn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"put",...t,signal:e}),Un=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"delete",...t,signal:e}),ea=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"get",...t,signal:e}),ta=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"put",...t,signal:e}),ra=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"patch",...t,signal:e}),aa=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"post",...t,signal:e}),sa=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"delete",...t,signal:e}),Fn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/bulk",method:"post",...t,signal:e}),na=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/query",method:"post",...t,signal:e}),ia=(t,e)=>d({url:"/db/{dbBranchName}/search",method:"post",...t,signal:e}),oa=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/search",method:"post",...t,signal:e}),ca=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/vectorSearch",method:"post",...t,signal:e}),Vn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/ask",method:"post",...t,signal:e}),la=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/ask/{sessionId}",method:"post",...t,signal:e}),ua=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/summarize",method:"post",...t,signal:e}),da=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/aggregate",method:"post",...t,signal:e}),Wn=(t,e)=>d({url:"/file/{fileId}",method:"get",...t,signal:e}),Ln=(t,e)=>d({url:"/file/{fileId}",method:"put",...t,signal:e}),ha=(t,e)=>d({url:"/db/{dbBranchName}/sql",method:"post",...t,signal:e}),qn={branch:{applyMigration:Gs,pgRollStatus:Hs,pgRollJobStatus:Xs,pgRollMigrationHistory:js,getBranchList:Ks,getBranchDetails:rr,createBranch:Qs,deleteBranch:Ys,copyBranch:Zs,updateBranchMetadata:en,getBranchMetadata:tn,getBranchStats:rn,getGitBranchesMapping:an,addGitBranchesEntry:sn,removeGitBranchesEntry:nn,resolveBranch:on},migrations:{getSchema:Js,getBranchMigrationHistory:cn,getBranchMigrationPlan:ln,executeBranchMigrationPlan:un,getBranchSchemaHistory:wn,compareBranchWithUserSchema:vn,compareBranchSchemas:Bn,updateBranchSchema:Sn,previewBranchSchemaEdit:Nn,applyBranchSchemaEdit:kn,pushBranchMigrations:Tn},migrationRequests:{queryMigrationRequests:dn,createMigrationRequest:hn,getMigrationRequest:mn,updateMigrationRequest:pn,listMigrationRequestsCommits:fn,compareMigrationRequest:gn,getMigrationRequestIsMerged:bn,mergeMigrationRequest:yn},table:{createTable:_n,deleteTable:In,updateTable:An,getTableSchema:Pn,setTableSchema:Mn,getTableColumns:xn,addTableColumn:Cn,getColumn:$n,updateColumn:En,deleteColumn:On},records:{branchTransaction:Le,insertRecord:Qr,getRecord:ea,insertRecordWithID:ta,updateRecordWithID:ra,upsertRecordWithID:aa,deleteRecord:sa,bulkInsertTableRecords:Fn},files:{getFileItem:Yr,putFileItem:Jr,deleteFileItem:Zr,getFile:Rn,putFile:Dn,deleteFile:Un,fileAccess:Wn,fileUpload:Ln},searchAndFilter:{queryTable:na,searchBranch:ia,searchTable:oa,vectorSearchTable:ca,askTable:Vn,askTableSession:la,summarizeTable:ua,aggregateTable:da},sql:{sqlQuery:ha}},y=async t=>Kr({...t,endpoint:"controlPlane"}),zn=(t,e)=>y({url:"/oauth/authorize",method:"get",...t,signal:e}),Gn=(t,e)=>y({url:"/oauth/authorize",method:"post",...t,signal:e}),Hn=(t,e)=>y({url:"/user",method:"get",...t,signal:e}),Xn=(t,e)=>y({url:"/user",method:"put",...t,signal:e}),jn=(t,e)=>y({url:"/user",method:"delete",...t,signal:e}),Kn=(t,e)=>y({url:"/user/keys",method:"get",...t,signal:e}),Qn=(t,e)=>y({url:"/user/keys/{keyName}",method:"post",...t,signal:e}),Yn=(t,e)=>y({url:"/user/keys/{keyName}",method:"delete",...t,signal:e}),Jn=(t,e)=>y({url:"/user/oauth/clients",method:"get",...t,signal:e}),Zn=(t,e)=>y({url:"/user/oauth/clients/{clientId}",method:"delete",...t,signal:e}),ei=(t,e)=>y({url:"/user/oauth/tokens",method:"get",...t,signal:e}),ti=(t,e)=>y({url:"/user/oauth/tokens/{token}",method:"delete",...t,signal:e}),ri=(t,e)=>y({url:"/user/oauth/tokens/{token}",method:"patch",...t,signal:e}),ai=(t,e)=>y({url:"/workspaces",method:"get",...t,signal:e}),si=(t,e)=>y({url:"/workspaces",method:"post",...t,signal:e}),ni=(t,e)=>y({url:"/workspaces/{workspaceId}",method:"get",...t,signal:e}),ii=(t,e)=>y({url:"/workspaces/{workspaceId}",method:"put",...t,signal:e}),oi=(t,e)=>y({url:"/workspaces/{workspaceId}",method:"delete",...t,signal:e}),ci=(t,e)=>y({url:"/workspaces/{workspaceId}/members",method:"get",...t,signal:e}),li=(t,e)=>y({url:"/workspaces/{workspaceId}/members/{userId}",method:"put",...t,signal:e}),ui=(t,e)=>y({url:"/workspaces/{workspaceId}/members/{userId}",method:"delete",...t,signal:e}),di=(t,e)=>y({url:"/workspaces/{workspaceId}/invites",method:"post",...t,signal:e}),hi=(t,e)=>y({url:"/workspaces/{workspaceId}/invites/{inviteId}",method:"patch",...t,signal:e}),mi=(t,e)=>y({url:"/workspaces/{workspaceId}/invites/{inviteId}",method:"delete",...t,signal:e}),pi=(t,e)=>y({url:"/workspaces/{workspaceId}/invites/{inviteKey}/accept",method:"post",...t,signal:e}),fi=(t,e)=>y({url:"/workspaces/{workspaceId}/invites/{inviteId}/resend",method:"post",...t,signal:e}),gi=(t,e)=>y({url:"/workspaces/{workspaceId}/clusters",method:"get",...t,signal:e}),bi=(t,e)=>y({url:"/workspaces/{workspaceId}/clusters",method:"post",...t,signal:e}),yi=(t,e)=>y({url:"/workspaces/{workspaceId}/clusters/{clusterId}",method:"get",...t,signal:e}),wi=(t,e)=>y({url:"/workspaces/{workspaceId}/clusters/{clusterId}",method:"patch",...t,signal:e}),vi=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs",method:"get",...t,signal:e}),Bi=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"put",...t,signal:e}),Si=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"delete",...t,signal:e}),Ni=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"get",...t,signal:e}),ki=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"patch",...t,signal:e}),Ti=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}/rename",method:"post",...t,signal:e}),_i=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"get",...t,signal:e}),Ii=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"put",...t,signal:e}),Ai=(t,e)=>y({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"delete",...t,signal:e}),Pi=(t,e)=>y({url:"/workspaces/{workspaceId}/regions",method:"get",...t,signal:e}),Mi={oAuth:{getAuthorizationCode:zn,grantAuthorizationCode:Gn,getUserOAuthClients:Jn,deleteUserOAuthClient:Zn,getUserOAuthAccessTokens:ei,deleteOAuthAccessToken:ti,updateOAuthAccessToken:ri},users:{getUser:Hn,updateUser:Xn,deleteUser:jn},authentication:{getUserAPIKeys:Kn,createUserAPIKey:Qn,deleteUserAPIKey:Yn},workspaces:{getWorkspacesList:ai,createWorkspace:si,getWorkspace:ni,updateWorkspace:ii,deleteWorkspace:oi,getWorkspaceMembersList:ci,updateWorkspaceMemberRole:li,removeWorkspaceMember:ui},invites:{inviteWorkspaceMember:di,updateWorkspaceMemberInvite:hi,cancelWorkspaceMemberInvite:mi,acceptWorkspaceMemberInvite:pi,resendWorkspaceMemberInvite:fi},xbcontrolOther:{listClusters:gi,createCluster:bi,getCluster:yi,updateCluster:wi},databases:{getDatabaseList:vi,createDatabase:Bi,deleteDatabase:Si,getDatabaseMetadata:Ni,updateDatabaseMetadata:ki,renameDatabase:Ti,getDatabaseGithubSettings:_i,updateDatabaseGithubSettings:Ii,deleteDatabaseGithubSettings:Ai,listRegions:Pi}};zr(qn,Mi);class qe{}function xi(t){return t.flatMap(e=>Object.entries(e).map(([r,a])=>{if(r==="trim"){const{left:s=0,top:n=0,right:i=0,bottom:o=0}=a;return`${r}=${[n,i,o,s].join(";")}`}if(r==="gravity"&&typeof a=="object"){const{x:s=.5,y:n=.5}=a;return`${r}=${[s,n].join("x")}`}return`${r}=${a}`})).join(",")}function He(t,...e){if(!A(t))return;const r=xi(e),{hostname:a,pathname:s,search:n}=new URL(t),i=s.split("/"),o=i.findIndex(h=>h==="transform"),l=`/transform/${[(o>=0?i.splice(o,2):[])[1],r].filter(A).join(",")}`,w=i.join("/");return`https://${a}${l}${w}${n}`}class ce{constructor(e){this.id=e.id,this.name=e.name,this.mediaType=e.mediaType,this.base64Content=e.base64Content,this.enablePublicUrl=e.enablePublicUrl,this.signedUrlTimeout=e.signedUrlTimeout,this.uploadUrlTimeout=e.uploadUrlTimeout,this.size=e.size,this.version=e.version,this.url=e.url,this.signedUrl=e.signedUrl,this.uploadUrl=e.uploadUrl,this.attributes=e.attributes}static fromBuffer(e,r={}){const a=e.toString("base64");return new ce({...r,base64Content:a})}toBuffer(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return Buffer.from(this.base64Content,"base64")}static fromArrayBuffer(e,r={}){const a=new Uint8Array(e);return this.fromUint8Array(a,r)}toArrayBuffer(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content);return new ArrayBuffer(e.length)}static fromUint8Array(e,r={}){let a="";for(let n=0;n<e.byteLength;n++)a+=String.fromCharCode(e[n]);const s=btoa(a);return new ce({...r,base64Content:s})}toUint8Array(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return r}static async fromBlob(e,r={}){const a=r.name??e.name,s=e.type,n=await e.arrayBuffer();return this.fromArrayBuffer(n,{...r,name:a,mediaType:s})}toBlob(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return new Blob([r],{type:this.mediaType})}static fromString(e,r={}){const a=btoa(e);return new ce({...r,base64Content:a})}toString(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return atob(this.base64Content)}static fromBase64(e,r={}){return new ce({...r,base64Content:e})}toBase64(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return this.base64Content}transform(...e){return{url:He(this.url,...e),signedUrl:He(this.signedUrl,...e),metadataUrl:He(this.url,...e,{format:"json"}),metadataSignedUrl:He(this.signedUrl,...e,{format:"json"})}}}const vr=async t=>{if(!A(t))return null;const{id:e,name:r,mediaType:a,base64Content:s,enablePublicUrl:n,signedUrlTimeout:i,uploadUrlTimeout:o}=await t;return Wr({id:e,name:r||void 0,mediaType:a,base64Content:s,enablePublicUrl:n,signedUrlTimeout:i,uploadUrlTimeout:o})};function ot(t){if(!A(t))return;if(!b(t))return t;const e=Object.fromEntries(Object.entries(t).reduce((r,[a,s])=>{if(!A(s))return r;if(Array.isArray(s)){const n=s.map(i=>ot(i)).filter(i=>A(i));return n.length===0?r:[...r,[a,n]]}if(b(s)){const n=ot(s);return A(n)?[...r,[a,n]]:r}return[...r,[a,s]]},[]));return Object.keys(e).length>0?e:void 0}function Ci(t){if(!A(t)||k(t))return t;try{return JSON.stringify(t)}catch{return t}}function $i(t){try{return JSON.parse(t)}catch{return t}}var ma=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},se=(t,e,r)=>(ma(t,e,"read from private field"),r?r.call(t):e.get(t)),pa=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},fa=(t,e,r,a)=>(ma(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),he,oe;class Br{constructor(e,r,a=[]){pa(this,he,void 0),fa(this,he,e),this.meta=r,this.records=new At(this,a)}async nextPage(e,r){return se(this,he).getPaginated({pagination:{size:e,offset:r,after:this.meta.page.cursor}})}async previousPage(e,r){return se(this,he).getPaginated({pagination:{size:e,offset:r,before:this.meta.page.cursor}})}async startPage(e,r){return se(this,he).getPaginated({pagination:{size:e,offset:r,start:this.meta.page.cursor}})}async endPage(e,r){return se(this,he).getPaginated({pagination:{size:e,offset:r,end:this.meta.page.cursor}})}hasNextPage(){return this.meta.page.more}}he=new WeakMap;const yt=1e3,Sr=20;function Ei(t){return A(t)&&(A(t.start)||A(t.end)||A(t.after)||A(t.before))}const Oi=class we extends Array{constructor(...e){super(...we.parseConstructorParams(...e)),pa(this,oe,void 0),fa(this,oe,b(e[0]?.meta)?e[0]:{meta:{page:{cursor:"",more:!1}},records:[]})}static parseConstructorParams(...e){if(e.length===1&&typeof e[0]=="number")return new Array(e[0]);if(e.length<=2&&b(e[0]?.meta)&&Array.isArray(e[1]??[])){const r=e[1]??e[0].records??[];return new Array(...r)}return new Array(...e)}toArray(){return new Array(...this)}toSerializable(){return JSON.parse(this.toString())}toString(){return JSON.stringify(this.toArray())}map(e,r){return this.toArray().map(e,r)}async nextPage(e,r){const a=await se(this,oe).nextPage(e,r);return new we(a)}async previousPage(e,r){const a=await se(this,oe).previousPage(e,r);return new we(a)}async startPage(e,r){const a=await se(this,oe).startPage(e,r);return new we(a)}async endPage(e,r){const a=await se(this,oe).endPage(e,r);return new we(a)}hasNextPage(){return se(this,oe).meta.page.more}};oe=new WeakMap;let At=Oi;var ar=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},m=(t,e,r)=>(ar(t,e,"read from private field"),r?r.call(t):e.get(t)),Xe=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},wt=(t,e,r,a)=>(ar(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Nr=(t,e,r)=>(ar(t,e,"access private method"),r),U,O,I,Ke,Pt;const Ri=class K{constructor(e,r,a,s){Xe(this,Ke),Xe(this,U,void 0),Xe(this,O,void 0),Xe(this,I,{filter:{}}),this.meta={page:{cursor:"start",more:!0,size:Sr}},this.records=new At(this,[]),wt(this,U,r),e?wt(this,O,e):wt(this,O,this);const n=Ui(a,s);m(this,I).filter=a.filter??n?.filter??{},m(this,I).filter.$any=a.filter?.$any??n?.filter?.$any,m(this,I).filter.$all=a.filter?.$all??n?.filter?.$all,m(this,I).filter.$not=a.filter?.$not??n?.filter?.$not,m(this,I).filter.$none=a.filter?.$none??n?.filter?.$none,m(this,I).sort=a.sort??n?.sort,m(this,I).columns=a.columns??n?.columns,m(this,I).consistency=a.consistency??n?.consistency,m(this,I).pagination=a.pagination??n?.pagination,m(this,I).cache=a.cache??n?.cache,m(this,I).fetchOptions=a.fetchOptions??n?.fetchOptions,this.any=this.any.bind(this),this.all=this.all.bind(this),this.not=this.not.bind(this),this.filter=this.filter.bind(this),this.sort=this.sort.bind(this),this.none=this.none.bind(this),Object.defineProperty(this,"table",{enumerable:!1}),Object.defineProperty(this,"repository",{enumerable:!1})}getQueryOptions(){return m(this,I)}key(){const{columns:e=[],filter:r={},sort:a=[],pagination:s={}}=m(this,I),n=JSON.stringify({columns:e,filter:r,sort:a,pagination:s});return bs(n)}any(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new K(m(this,O),m(this,U),{filter:{$any:r}},m(this,I))}all(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new K(m(this,O),m(this,U),{filter:{$all:r}},m(this,I))}not(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new K(m(this,O),m(this,U),{filter:{$not:r}},m(this,I))}none(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new K(m(this,O),m(this,U),{filter:{$none:r}},m(this,I))}filter(e,r){if(arguments.length===1){const a=Object.entries(e??{}).map(([n,i])=>({[n]:Nr(this,Ke,Pt).call(this,n,i)})),s=ne([m(this,I).filter?.$all].flat().concat(a));return new K(m(this,O),m(this,U),{filter:{$all:s}},m(this,I))}else{const a=A(e)&&A(r)?[{[e]:Nr(this,Ke,Pt).call(this,e,r)}]:void 0,s=ne([m(this,I).filter?.$all].flat().concat(a));return new K(m(this,O),m(this,U),{filter:{$all:s}},m(this,I))}}sort(e,r="asc"){const s=[...[m(this,I).sort??[]].flat(),{column:e,direction:r}];return new K(m(this,O),m(this,U),{sort:s},m(this,I))}select(e){return new K(m(this,O),m(this,U),{columns:e},m(this,I))}getPaginated(e={}){const r=new K(m(this,O),m(this,U),e,m(this,I));return m(this,O).query(r)}async*[Symbol.asyncIterator](){for await(const[e]of this.getIterator({batchSize:1}))yield e}async*getIterator(e={}){const{batchSize:r=1}=e;let a=await this.getPaginated({...e,pagination:{size:r,offset:0}}),s=a.hasNextPage();for(yield a.records;s;)a=await a.nextPage(),s=a.hasNextPage(),yield a.records}async getMany(e={}){const{pagination:r={},...a}=e,{size:s=Sr,offset:n}=r,i=s<=yt?s:yt;let o=await this.getPaginated({...a,pagination:{size:i,offset:n}});const c=[...o.records];for(;o.hasNextPage()&&c.length<s;)o=await o.nextPage(),c.push(...o.records);return o.hasNextPage()&&e.pagination?.size===void 0&&console.trace("Calling getMany does not return all results. Paginate to get all results or call getAll."),new At(o,c.slice(0,s))}async getAll(e={}){const{batchSize:r=yt,...a}=e,s=[];for await(const n of this.getIterator({...a,batchSize:r}))s.push(...n);return s}async getFirst(e={}){return(await this.getMany({...e,pagination:{size:1}}))[0]??null}async getFirstOrThrow(e={}){const r=await this.getMany({...e,pagination:{size:1}});if(r[0]===void 0)throw new Error("No results found.");return r[0]}async summarize(e={}){const{summaries:r,summariesFilter:a,...s}=e,n=new K(m(this,O),m(this,U),s,m(this,I));return m(this,O).summarizeTable(n,r,a)}cache(e){return new K(m(this,O),m(this,U),{cache:e},m(this,I))}nextPage(e,r){return this.startPage(e,r)}previousPage(e,r){return this.startPage(e,r)}startPage(e,r){return this.getPaginated({pagination:{size:e,offset:r}})}endPage(e,r){return this.getPaginated({pagination:{size:e,offset:r,before:"end"}})}hasNextPage(){return this.meta.page.more}};U=new WeakMap;O=new WeakMap;I=new WeakMap;Ke=new WeakSet;Pt=function(t,e){const r=m(this,U).schema?.columns.find(({name:a})=>a===t)?.type;return r==="multiple"&&(k(e)||Lr(e))?{$includes:e}:r==="link"&&b(e)&&k(e.id)?e.id:e};let Di=Ri;function Ui(t,e){return Ei(t.pagination)?{...e,sort:void 0,filter:void 0}:e}function Fi(t){return b(t)&&k(t?.id)}function Vi(t){return b(t)&&k(t.name)}function D(t){return Array.isArray(t)?t.every(e=>typeof e=="string"?!0:typeof e=="object"?Vi(e):!1):!1}function Wi(t){return k(t)}function ga(t){return b(t)&&Object.entries(t).every(([e,r])=>e==="*"?r==="random":r==="asc"||r==="desc")}function Li(t){return b(t)&&!ga(t)&&t.column!==void 0}function Mt(t){if(Wi(t))return{[t]:"asc"};if(Array.isArray(t))return t.map(e=>Mt(e));if(ga(t))return t;if(Li(t))return{[t.column]:t.direction??"asc"};throw new Error(`Invalid sort filter: ${t}`)}var sr=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},u=(t,e,r)=>(sr(t,e,"read from private field"),r?r.call(t):e.get(t)),E=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},me=(t,e,r,a)=>(sr(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),S=(t,e,r)=>(sr(t,e,"access private method"),r),N,C,G,Ie,Te,R,xt,ba,ve,Oe,Qe,Ct,Ye,$t,Je,Et,Ze,Ot,et,Rt,Dt,ya,Ut,wa,Ft,va,H,Q,ge,Pe;const nr=1e3;class kr extends Di{constructor(e){super(null,{name:e.table,schema:e.schemaTables?.find(a=>a.name===e.table)},{}),E(this,xt),E(this,ve),E(this,Qe),E(this,Ye),E(this,Je),E(this,Ze),E(this,et),E(this,Dt),E(this,Ut),E(this,Ft),E(this,H),E(this,ge),E(this,N,void 0),E(this,C,void 0),E(this,G,void 0),E(this,Ie,void 0),E(this,Te,void 0),E(this,R,void 0),me(this,N,e.table),me(this,G,e.db),me(this,Ie,e.pluginOptions.cache),me(this,Te,e.schemaTables),me(this,C,()=>({...e.pluginOptions,sessionID:We()}));const r=e.pluginOptions.trace??Fr;me(this,R,async(a,s,n={})=>r(a,s,{...n,[z.TABLE]:u(this,N),[z.KIND]:"sdk-operation",[z.VERSION]:tr}))}async create(e,r,a,s){return u(this,R).call(this,"create",async()=>{const n=Ne(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await S(this,Qe,Ct).call(this,e,{ifVersion:n,createOnly:!0}),o=D(r)?r:["*"];return await this.read(i,o)}if(k(e)&&b(r)){if(e==="")throw new Error("The id can't be empty");const i=D(a)?a:void 0;return await S(this,ve,Oe).call(this,e,r,i,{createOnly:!0,ifVersion:n})}if(b(e)&&k(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=D(r)?r:void 0;return await S(this,ve,Oe).call(this,e.id,{...e,id:void 0},i,{createOnly:!0,ifVersion:n})}if(b(e)){const i=D(r)?r:void 0;return S(this,xt,ba).call(this,e,i)}throw new Error("Invalid arguments for create method")})}async read(e,r){return u(this,R).call(this,"read",async()=>{const a=D(r)?r:["*"];if(Array.isArray(e)){if(e.length===0)return[];const n=e.map(c=>ie(c)),o=(await this.getAll({filter:{id:{$any:ne(n)}},columns:a})).reduce((c,l)=>(c[l.id]=l,c),{});return n.map(c=>o[c??""]??null)}const s=ie(e);if(s)try{const n=await ea({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),recordId:s},queryParams:{columns:a},...u(this,C).call(this)}),i=await S(this,H,Q).call(this);return X(u(this,G),i,u(this,N),n,a)}catch(n){if(b(n)&&n.status===404)return null;throw n}return null})}async readOrThrow(e,r){return u(this,R).call(this,"readOrThrow",async()=>{const a=await this.read(e,r);if(Array.isArray(a)){const s=ne(e.filter((n,i)=>a[i]===null).map(n=>ie(n)));if(s.length>0)throw new Error(`Could not find records with ids: ${s.join(", ")}`);return a}if(a===null){const s=ie(e)??"unknown";throw new Error(`Record with id ${s} not found`)}return a})}async update(e,r,a,s){return u(this,R).call(this,"update",async()=>{const n=Ne(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await this.read(e,["id"]),o=e.filter((w,h)=>i[h]!==null);await S(this,Je,Et).call(this,o,{ifVersion:n,upsert:!1});const c=D(r)?r:["*"];return await this.read(e,c)}try{if(k(e)&&b(r)){const i=D(a)?a:void 0;return await S(this,Ye,$t).call(this,e,r,i,{ifVersion:n})}if(b(e)&&k(e.id)){const i=D(r)?r:void 0;return await S(this,Ye,$t).call(this,e.id,{...e,id:void 0},i,{ifVersion:n})}}catch(i){if(i.status===422)return null;throw i}throw new Error("Invalid arguments for update method")})}async updateOrThrow(e,r,a,s){return u(this,R).call(this,"updateOrThrow",async()=>{const n=await this.update(e,r,a,s);if(Array.isArray(n)){const i=ne(e.filter((o,c)=>n[c]===null).map(o=>ie(o)));if(i.length>0)throw new Error(`Could not find records with ids: ${i.join(", ")}`);return n}if(n===null){const i=ie(e)??"unknown";throw new Error(`Record with id ${i} not found`)}return n})}async createOrUpdate(e,r,a,s){return u(this,R).call(this,"createOrUpdate",async()=>{const n=Ne(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];await S(this,Je,Et).call(this,e,{ifVersion:n,upsert:!0});const i=D(r)?r:["*"];return await this.read(e,i)}if(k(e)&&b(r)){if(e==="")throw new Error("The id can't be empty");const i=D(a)?a:void 0;return await S(this,Ze,Ot).call(this,e,r,i,{ifVersion:n})}if(b(e)&&k(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=D(a)?a:void 0;return await S(this,Ze,Ot).call(this,e.id,{...e,id:void 0},i,{ifVersion:n})}if(!A(e)&&b(r))return await this.create(r,a);if(b(e)&&!A(e.id))return await this.create(e,r);throw new Error("Invalid arguments for createOrUpdate method")})}async createOrReplace(e,r,a,s){return u(this,R).call(this,"createOrReplace",async()=>{const n=Ne(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await S(this,Qe,Ct).call(this,e,{ifVersion:n,createOnly:!1}),o=D(r)?r:["*"];return await this.read(i,o)}if(k(e)&&b(r)){if(e==="")throw new Error("The id can't be empty");const i=D(a)?a:void 0;return await S(this,ve,Oe).call(this,e,r,i,{createOnly:!1,ifVersion:n})}if(b(e)&&k(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=D(a)?a:void 0;return await S(this,ve,Oe).call(this,e.id,{...e,id:void 0},i,{createOnly:!1,ifVersion:n})}if(!A(e)&&b(r))return await this.create(r,a);if(b(e)&&!A(e.id))return await this.create(e,r);throw new Error("Invalid arguments for createOrReplace method")})}async delete(e,r){return u(this,R).call(this,"delete",async()=>{if(Array.isArray(e)){if(e.length===0)return[];const a=e.map(i=>{if(k(i))return i;if(k(i.id))return i.id;throw new Error("Invalid arguments for delete method")}),s=D(r)?r:["*"],n=await this.read(e,s);return await S(this,Dt,ya).call(this,a),n}if(k(e))return S(this,et,Rt).call(this,e,r);if(b(e)&&k(e.id))return S(this,et,Rt).call(this,e.id,r);throw new Error("Invalid arguments for delete method")})}async deleteOrThrow(e,r){return u(this,R).call(this,"deleteOrThrow",async()=>{const a=await this.delete(e,r);if(Array.isArray(a)){const s=ne(e.filter((n,i)=>a[i]===null).map(n=>ie(n)));if(s.length>0)throw new Error(`Could not find records with ids: ${s.join(", ")}`);return a}else if(a===null){const s=ie(e)??"unknown";throw new Error(`Record with id ${s} not found`)}return a})}async search(e,r={}){return u(this,R).call(this,"search",async()=>{const{records:a,totalCount:s}=await oa({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},body:{query:e,fuzziness:r.fuzziness,prefix:r.prefix,highlight:r.highlight,filter:r.filter,boosters:r.boosters,page:r.page,target:r.target},...u(this,C).call(this)}),n=await S(this,H,Q).call(this);return{records:a.map(i=>X(u(this,G),n,u(this,N),i,["*"])),totalCount:s}})}async vectorSearch(e,r,a){return u(this,R).call(this,"vectorSearch",async()=>{const{records:s,totalCount:n}=await ca({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},body:{column:e,queryVector:r,similarityFunction:a?.similarityFunction,size:a?.size,filter:a?.filter},...u(this,C).call(this)}),i=await S(this,H,Q).call(this);return{records:s.map(o=>X(u(this,G),i,u(this,N),o,["*"])),totalCount:n}})}async aggregate(e,r){return u(this,R).call(this,"aggregate",async()=>await da({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},body:{aggs:e,filter:r},...u(this,C).call(this)}))}async query(e){return u(this,R).call(this,"query",async()=>{const r=await S(this,Ft,va).call(this,e);if(r)return new Br(e,r.meta,r.records);const a=e.getQueryOptions(),{meta:s,records:n}=await na({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},body:{filter:ot(a.filter),sort:a.sort!==void 0?Mt(a.sort):void 0,page:a.pagination,columns:a.columns??["*"],consistency:a.consistency},fetchOptions:a.fetchOptions,...u(this,C).call(this)}),i=await S(this,H,Q).call(this),o=n.map(c=>X(u(this,G),i,u(this,N),c,a.columns??["*"]));return await S(this,Ut,wa).call(this,e,s,o),new Br(e,s,o)})}async summarizeTable(e,r,a){return u(this,R).call(this,"summarize",async()=>{const s=e.getQueryOptions(),n=await ua({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},body:{filter:ot(s.filter),sort:s.sort!==void 0?Mt(s.sort):void 0,columns:s.columns,consistency:s.consistency,page:s.pagination?.size!==void 0?{size:s.pagination?.size}:void 0,summaries:r,summariesFilter:a},...u(this,C).call(this)}),i=await S(this,H,Q).call(this);return{...n,summaries:n.summaries.map(o=>X(u(this,G),i,u(this,N),o,s.columns??[]))}})}ask(e,r){const a=r?.sessionId?{message:e}:{question:e},s={pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),sessionId:r?.sessionId},body:{...a,rules:r?.rules,searchType:r?.searchType,search:r?.searchType==="keyword"?r?.search:void 0,vectorSearch:r?.searchType==="vector"?r?.vectorSearch:void 0},...u(this,C).call(this)};if(r?.onMessage)qs({endpoint:"dataPlane",url:"/db/{dbBranchName}/tables/{tableName}/ask/{sessionId}",method:"POST",onMessage:n=>{r.onMessage?.({answer:n.text,records:n.records})},...s});else return la(s)}}N=new WeakMap;C=new WeakMap;G=new WeakMap;Ie=new WeakMap;Te=new WeakMap;R=new WeakMap;xt=new WeakSet;ba=async function(t,e=["*"]){const r=await S(this,ge,Pe).call(this,t),a=await Qr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N)},queryParams:{columns:e},body:r,...u(this,C).call(this)}),s=await S(this,H,Q).call(this);return X(u(this,G),s,u(this,N),a,e)};ve=new WeakSet;Oe=async function(t,e,r=["*"],{createOnly:a,ifVersion:s}){if(!t)return null;const n=await S(this,ge,Pe).call(this,e),i=await ta({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),recordId:t},body:n,queryParams:{createOnly:a,columns:r,ifVersion:s},...u(this,C).call(this)}),o=await S(this,H,Q).call(this);return X(u(this,G),o,u(this,N),i,r)};Qe=new WeakSet;Ct=async function(t,{createOnly:e,ifVersion:r}){const a=await Zt(t,async i=>{const o=await S(this,ge,Pe).call(this,i);return{insert:{table:u(this,N),record:o,createOnly:e,ifVersion:r}}}),s=Jt(a,nr),n=[];for(const i of s){const{results:o}=await Le({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:i},...u(this,C).call(this)});for(const c of o)c.operation==="insert"?n.push(c.id):n.push(null)}return n};Ye=new WeakSet;$t=async function(t,e,r=["*"],{ifVersion:a}){if(!t)return null;const{id:s,...n}=await S(this,ge,Pe).call(this,e);try{const i=await ra({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),recordId:t},queryParams:{columns:r,ifVersion:a},body:n,...u(this,C).call(this)}),o=await S(this,H,Q).call(this);return X(u(this,G),o,u(this,N),i,r)}catch(i){if(b(i)&&i.status===404)return null;throw i}};Je=new WeakSet;Et=async function(t,{ifVersion:e,upsert:r}){const a=await Zt(t,async({id:i,...o})=>{const c=await S(this,ge,Pe).call(this,o);return{update:{table:u(this,N),id:i,ifVersion:e,upsert:r,fields:c}}}),s=Jt(a,nr),n=[];for(const i of s){const{results:o}=await Le({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:i},...u(this,C).call(this)});for(const c of o)c.operation==="update"?n.push(c.id):n.push(null)}return n};Ze=new WeakSet;Ot=async function(t,e,r=["*"],{ifVersion:a}){if(!t)return null;const s=await aa({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),recordId:t},queryParams:{columns:r,ifVersion:a},body:e,...u(this,C).call(this)}),n=await S(this,H,Q).call(this);return X(u(this,G),n,u(this,N),s,r)};et=new WeakSet;Rt=async function(t,e=["*"]){if(!t)return null;try{const r=await sa({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,N),recordId:t},queryParams:{columns:e},...u(this,C).call(this)}),a=await S(this,H,Q).call(this);return X(u(this,G),a,u(this,N),r,e)}catch(r){if(b(r)&&r.status===404)return null;throw r}};Dt=new WeakSet;ya=async function(t){const e=Jt(ne(t).map(r=>({delete:{table:u(this,N),id:r}})),nr);for(const r of e)await Le({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:r},...u(this,C).call(this)})};Ut=new WeakSet;wa=async function(t,e,r){await u(this,Ie)?.set(`query_${u(this,N)}:${t.key()}`,{date:new Date,meta:e,records:r})};Ft=new WeakSet;va=async function(t){const e=`query_${u(this,N)}:${t.key()}`,r=await u(this,Ie)?.get(e);if(!r)return null;const a=u(this,Ie)?.defaultQueryTTL??-1,{cache:s=a}=t.getQueryOptions();return s<0||r.date.getTime()+s<Date.now()?null:r};H=new WeakSet;Q=async function(){if(u(this,Te))return u(this,Te);const{schema:t}=await rr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},...u(this,C).call(this)});return me(this,Te,t.tables),t.tables};ge=new WeakSet;Pe=async function(t){const r=(await S(this,H,Q).call(this)).find(s=>s.name===u(this,N));if(!r)throw new Error(`Table ${u(this,N)} not found in schema`);const a={};for(const[s,n]of Object.entries(t)){if(s==="xata")continue;switch(r.columns.find(o=>o.name===s)?.type){case"link":{a[s]=Fi(n)?n.id:n;break}case"datetime":{a[s]=n instanceof Date?n.toISOString():n;break}case"file":a[s]=await vr(n);break;case"file[]":a[s]=await Zt(n,o=>vr(o));break;case"json":a[s]=Ci(n);break;default:a[s]=n}}return a};const X=(t,e,r,a,s)=>{const n={},{xata:i,...o}=a??{};Object.assign(n,o);const{columns:c}=e.find(({name:h})=>h===r)??{};c||console.error(`Table ${r} not found in schema`);for(const h of c??[]){if(!qi(s,h))continue;const v=n[h.name];switch(h.type){case"datetime":{const P=v!==void 0?new Date(v):null;P!==null&&isNaN(P.getTime())?console.error(`Failed to parse date ${v} for field ${h.name}`):n[h.name]=P;break}case"link":{const P=h.link?.table;if(!P)console.error(`Failed to parse link for field ${h.name}`);else if(b(v)){const x=s.reduce((M,p)=>{if(p===h.name)return[...M,"*"];if(k(p)&&p.startsWith(`${h.name}.`)){const[,...f]=p.split(".");return[...M,f.join(".")]}return M},[]);n[h.name]=X(t,e,P,v,x)}else n[h.name]=null;break}case"file":n[h.name]=A(v)?new ce(v):null;break;case"file[]":n[h.name]=v?.map(P=>new ce(P))??null;break;case"json":n[h.name]=$i(v);break;default:n[h.name]=v??null,h.notNull===!0&&v===null&&console.error(`Parse error, column ${h.name} is non nullable and value resolves null`);break}}const l={...n},w=i!==void 0?{...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}:void 0;l.read=function(h){return t[r].read(l.id,h)},l.update=function(h,v,P){const x=D(v)?v:["*"],M=Ne(v,P);return t[r].update(l.id,h,x,{ifVersion:M})},l.replace=function(h,v,P){const x=D(v)?v:["*"],M=Ne(v,P);return t[r].createOrReplace(l.id,h,x,{ifVersion:M})},l.delete=function(){return t[r].delete(l.id)},w!==void 0&&(l.xata=Object.freeze(w)),l.getMetadata=function(){return l.xata},l.toSerializable=function(){return JSON.parse(JSON.stringify(l))},l.toString=function(){return JSON.stringify(l)};for(const h of["read","update","replace","delete","getMetadata","toSerializable","toString"])Object.defineProperty(l,h,{enumerable:!1});return Object.freeze(l),l};function ie(t){if(k(t))return t;if(b(t)&&k(t.id))return t.id}function qi(t,e){return t.includes("*")?!0:t.filter(r=>k(r)&&r.startsWith(e.name)).length>0}function Ne(...t){for(const e of t)if(b(e)&&qr(e.ifVersion))return e.ifVersion}var Ba=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},de=(t,e,r)=>(Ba(t,e,"read from private field"),r?r.call(t):e.get(t)),zi=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Gi=(t,e,r,a)=>(Ba(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),re;class Hi{constructor(e={}){zi(this,re,void 0),Gi(this,re,new Map),this.capacity=e.max??500,this.defaultQueryTTL=e.defaultQueryTTL??60*1e3}async getAll(){return Object.fromEntries(de(this,re))}async get(e){return de(this,re).get(e)??null}async set(e,r){if(await this.delete(e),de(this,re).set(e,r),de(this,re).size>this.capacity){const a=de(this,re).keys().next().value;await this.delete(a)}}async delete(e){de(this,re).delete(e)}async clear(){return de(this,re).clear()}}re=new WeakMap;var Sa=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},ye=(t,e,r)=>(Sa(t,e,"read from private field"),r?r.call(t):e.get(t)),Tr=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Xi=(t,e,r,a)=>(Sa(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Re,Be;class ji extends qe{constructor(e){super(),Tr(this,Re,{}),Tr(this,Be,void 0),Xi(this,Be,e)}build(e){const r=new Proxy({},{get:(s,n)=>{if(!k(n))throw new Error("Invalid table name");return ye(this,Re)[n]===void 0&&(ye(this,Re)[n]=new kr({db:r,pluginOptions:e,table:n,schemaTables:ye(this,Be)})),ye(this,Re)[n]}}),a=ye(this,Be)?.map(({name:s})=>s)??[];for(const s of a)r[s]=new kr({db:r,pluginOptions:e,table:s,schemaTables:ye(this,Be)});return r}}Re=new WeakMap;Be=new WeakMap;class Ki extends qe{build(e){return{download:async r=>{const{table:a,record:s,column:n,fileId:i=""}=r??{};return await Yr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:a??"",recordId:s??"",columnName:n??"",fileId:i},...e,rawResponse:!0})},upload:async(r,a,s)=>{const{table:n,record:i,column:o,fileId:c=""}=r??{},l=await a,w=s?.mediaType||Qi(l),h=l instanceof ce?l.toBlob():l;return await Jr({...e,pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:n??"",recordId:i??"",columnName:o??"",fileId:c},body:h,headers:{"Content-Type":w}})},delete:async r=>{const{table:a,record:s,column:n,fileId:i=""}=r??{};return await Zr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:a??"",recordId:s??"",columnName:n??"",fileId:i},...e})}}}}function Qi(t){if(typeof t=="string")return"text/plain";if("mediaType"in t&&t.mediaType!==void 0)return t.mediaType;if(Yt(t))return t.type;try{return t.type}catch{}return"application/octet-stream"}var ir=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},_r=(t,e,r)=>(ir(t,e,"read from private field"),r?r.call(t):e.get(t)),vt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Na=(t,e,r,a)=>(ir(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),je=(t,e,r)=>(ir(t,e,"access private method"),r),_e,tt,Vt,rt,Wt;class Yi extends qe{constructor(e,r){super(),this.db=e,vt(this,tt),vt(this,rt),vt(this,_e,void 0),Na(this,_e,r)}build(e){return{all:async(r,a={})=>{const{records:s,totalCount:n}=await je(this,tt,Vt).call(this,r,a,e),i=await je(this,rt,Wt).call(this,e);return{totalCount:n,records:s.map(o=>{const{table:c="orphan"}=o.xata;return{table:c,record:X(this.db,i,c,o,["*"])}})}},byTable:async(r,a={})=>{const{records:s,totalCount:n}=await je(this,tt,Vt).call(this,r,a,e),i=await je(this,rt,Wt).call(this,e),o=s.reduce((c,l)=>{const{table:w="orphan"}=l.xata,h=c[w]??[],v=X(this.db,i,w,l,["*"]);return{...c,[w]:[...h,v]}},{});return{totalCount:n,records:o}}}}}_e=new WeakMap;tt=new WeakSet;Vt=async function(t,e,r){const{tables:a,fuzziness:s,highlight:n,prefix:i,page:o}=e??{},{records:c,totalCount:l}=await ia({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{tables:a,query:t,fuzziness:s,prefix:i,highlight:n,page:o},...r});return{records:c,totalCount:l}};rt=new WeakSet;Wt=async function(t){if(_r(this,_e))return _r(this,_e);const{schema:e}=await rr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},...t});return Na(this,_e,e.tables),e.tables};function Ji(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function ka(t){let e="{";for(let r=0;r<t.length;r++)r>0&&(e=e+","),t[r]===null||typeof t[r]>"u"?e=e+"NULL":Array.isArray(t[r])?e=e+ka(t[r]):t[r]instanceof Buffer?e+="\\\\x"+t[r].toString("hex"):e+=Ji(at(t[r]));return e=e+"}",e}function at(t){if(!A(t))return null;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return ka(t);if(b(t))return JSON.stringify(t);try{return t.toString()}catch{return t}}function Zi(t,e){if(k(t))return{statement:t,params:e?.map(r=>at(r))};if(Lr(t))return{statement:t.reduce((a,s,n)=>a+s+(n<(e?.length??0)?"$"+(n+1):""),""),params:e?.map(a=>at(a))};if(b(t)){const{statement:r,params:a,consistency:s}=t;return{statement:r,params:a?.map(n=>at(n)),consistency:s}}throw new Error("Invalid query")}class eo extends qe{build(e){return async(r,...a)=>{const{statement:s,params:n,consistency:i}=Zi(r,a),{records:o,warning:c}=await ha({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{statement:s,params:n,consistency:i},...e});return{records:o,warning:c}}}}class to extends qe{build(e){return{run:async r=>await Le({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:r},...e})}}}var or=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Ir=(t,e,r)=>(or(t,e,"read from private field"),r?r.call(t):e.get(t)),Bt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},ro=(t,e,r,a)=>(or(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Ar=(t,e,r)=>(or(t,e,"access private method"),r);const Ta=t=>{var e,r,a,s,n,i;return i=class{constructor(o={},c){Bt(this,r),Bt(this,s),Bt(this,e,void 0);const l=Ar(this,r,a).call(this,o);ro(this,e,l);const w={...Ar(this,s,n).call(this,l),cache:l.cache,host:l.host},h=new ji(c).build(w),v=new Yi(h,c).build(w),P=new to().build(w),x=new eo().build(w),M=new Ki().build(w);this.db=h,this.search=v,this.transactions=P,this.sql=x,this.files=M;for(const[p,f]of Object.entries(t??{}))f!==void 0&&(this[p]=f.build(w))}async getConfig(){const o=Ir(this,e).databaseURL,c=Ir(this,e).branch;return{databaseURL:o,branch:c}}},e=new WeakMap,r=new WeakSet,a=function(o){const c=o?.enableBrowser??vs()??!1;if(typeof window<"u"&&typeof Deno>"u"&&!c)throw new Error("You are trying to use Xata from the browser, which is potentially a non-secure environment. If you understand the security concerns, such as leaking your credentials, pass `enableBrowser: true` to the client options to remove this error.");const w=As(o?.fetch),h=o?.databaseURL||Bs(),v=o?.apiKey||Ss(),P=o?.cache??new Hi({defaultQueryTTL:0}),x=o?.trace??Fr,M=o?.clientName,p=o?.host??"production",f=o?.xataAgentExtra;if(!v)throw new Error("Option apiKey is required");if(!h)throw new Error("Option databaseURL is required");const B=Ns(),T=Ts(),_=o?.branch||T||B||"main";return T&&_!==T?console.warn(`Ignoring preview branch ${T} because branch option was passed to the client constructor with value ${_}`):B&&_!==B?console.warn(`Ignoring branch ${B} because branch option was passed to the client constructor with value ${_}`):T&&B&&T!==B?console.warn(`Ignoring preview branch ${T} and branch ${B} because branch option was passed to the client constructor with value ${_}`):!T&&!B&&o?.branch===void 0&&console.warn(`No branch was passed to the client constructor. Using default branch ${_}. You can set the branch with the environment variable XATA_BRANCH or by passing the branch option to the client constructor.`),{fetch:w,databaseURL:h,apiKey:v,branch:_,cache:P,trace:x,host:p,clientID:We(),enableBrowser:c,clientName:M,xataAgentExtra:f}},s=new WeakSet,n=function({fetch:o,apiKey:c,databaseURL:l,branch:w,trace:h,clientID:v,clientName:P,xataAgentExtra:x}){return{fetch:o,apiKey:c,apiUrl:"",workspacesApiUrl:(M,p)=>{const f=p.dbBranchName??p.branch,B=M.replace(/^\/db\/[^/]+/,f!==void 0?`:${w}`:"");return l+B},trace:h,clientID:v,clientName:P,xataAgentExtra:x}},i};class Ho extends Ta(){}const ao=[{name:"community",columns:[{name:"profilePicUrl",type:"string"},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"discordWebhookId",type:"string",defaultValue:""},{name:"profilePicFile",type:"file",file:{defaultPublicAccess:!0}},{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"bio",type:"string",notNull:!0,defaultValue:""},{name:"bioMediaUrls",type:"string",notNull:!0,defaultValue:""},{name:"tags",type:"string",notNull:!0,defaultValue:""},{name:"socials",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"bioMediaFiles",type:"file[]","file[]":{defaultPublicAccess:!0}},{name:"homeGalaxy",type:"string",notNull:!0,defaultValue:""},{name:"coordinates",type:"string",notNull:!0,defaultValue:""},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"community",table:"communityBuilder"}]},{name:"builder",columns:[{name:"profilePicUrl",type:"string"},{name:"profilePicFile",type:"file",file:{defaultPublicAccess:!0}},{name:"bio",type:"string",notNull:!0,defaultValue:""},{name:"platforms",type:"string",notNull:!0,defaultValue:""},{name:"buildTechniquesUsed",type:"string",notNull:!0,defaultValue:""},{name:"startedPlaying",type:"datetime",notNull:!0,defaultValue:"2016-08-09T00:00:00.000Z"},{name:"labels",type:"string",notNull:!0,defaultValue:""},{name:"socials",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"discordWebhookId",type:"string",notNull:!0,defaultValue:""},{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"builder",table:"communityBuilder"},{column:"builder",table:"planetBuildBuilder"}]},{name:"communityBuilder",columns:[{name:"community",type:"link",link:{table:"community"}},{name:"builder",type:"link",link:{table:"builder"}}]},{name:"planetBuild",columns:[{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"mediaUrls",type:"string",notNull:!0,defaultValue:""},{name:"mediaFiles",type:"file[]"},{name:"galaxy",type:"string",notNull:!0,defaultValue:""},{name:"systemName",type:"string",notNull:!0,defaultValue:""},{name:"planetName",type:"string",notNull:!0,defaultValue:""},{name:"coordinates",type:"string",notNull:!0,defaultValue:""},{name:"buildTechniquesUsed",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"discordWebhookId",type:"string",notNull:!0,defaultValue:""},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"planetBuild",table:"planetBuildBuilder"}]},{name:"planetBuildBuilder",columns:[{name:"planetBuild",type:"link",link:{table:"planetBuild"}},{name:"builder",type:"link",link:{table:"builder"}}]}],so=Ta(),no={databaseURL:"https://AssistantNMS-9tmlv0.eu-central-1.xata.sh/db/nmsud-submission"};class io extends so{constructor(e){super({...no,...e},ao)}}var oo=Object.defineProperty,co=Object.getOwnPropertyDescriptor,lo=(t,e,r,a)=>{for(var s=a>1?void 0:a?co(e,r):e,n=t.length-1,i;n>=0;n--)(i=t[n])&&(s=(a?i(e,r,s):i(s))||s);return a&&s&&oo(e,r,s),s};let Lt=class{_xata;constructor(){const t=Z();this._xata=new io({apiKey:t.getXataApiKey(),databaseURL:t.getXataDbUrl(),branch:t.getXataFallbackBranch()})}community=()=>xe({logName:"Community",repo:this._xata.db.community,files:this._xata.files});builder=()=>xe({logName:"Builder",repo:this._xata.db.builder,files:this._xata.files});communityBuilder=()=>({...xe({logName:"CommunityBuilder",repo:this._xata.db.communityBuilder,files:this._xata.files}),getByBuilderId:us(this._xata),getByCommunityId:ds(this._xata),getNumberOfBuilders:hs(this._xata)});planetBuild=()=>xe({logName:"PlanetBuild",repo:this._xata.db.planetBuild,files:this._xata.files});planetBuildBuilder=()=>({...xe({logName:"PlanetBuildBuilder",repo:this._xata.db.planetBuildBuilder,files:this._xata.files}),getByBuilderId:ms(this._xata),getByPlanetBuildId:ps(this._xata),getNumberOfBuilds:fs(this._xata)})};Lt=lo([ct()],Lt);const _a=()=>lt.get(Lt),uo=t=>e=>Or(t,e)?{isValid:!0}:{isValid:!1,errorMessage:`${e} | Minimum date is ${jt(t,"DD MMM YY")}`},ho=t=>e=>Or(e,t)?{isValid:!0}:{isValid:!1,errorMessage:`Maximum date is ${jt(t,"DD MMM YY")}`};var Fe=(t=>(t[t.File=0]="File",t[t.ImageUrl=1]="ImageUrl",t[t.VideoUrl=2]="VideoUrl",t))(Fe||{});const mo=t=>e=>e==null||e.name==null||e.fileSize==null?{isValid:!1,errorMessage:t??"Upload a valid image."}:{isValid:!0,errorMessage:""},Ia=t=>e=>{const r=e.name??"unknown name";if(t.maxHeight!=null&&t.maxHeight<e.height)return{isValid:!1,errorMessage:`Image '${r}' is too large, height should be less than or equal to ${t.maxHeight}px.`};if(t.maxWidth!=null&&t.maxWidth<e.width)return{isValid:!1,errorMessage:`Image '${r}' is too large, width should be less than or equal to ${t.maxWidth}px.`};if(t.minHeight!=null&&t.minHeight>e.height)return{isValid:!1,errorMessage:`Image '${r}' is too small, height should be greater than or equal to ${t.minHeight}px.`};if(t.minWidth!=null&&t.minWidth>e.width)return{isValid:!1,errorMessage:`Image '${r}' is too small, width should be greater than or equal to ${t.minWidth}px.`};if(t.maxSizeMb!=null){const a=e.fileSize/1048576;if(t.maxSizeMb<a)return{isValid:!1,errorMessage:`Image '${r}' is too large, image size limit is ${t.maxSizeMb}mb.`}}return{isValid:!0,errorMessage:""}},Pr=(t,e)=>r=>{if(r==null||r.type==null)return{isValid:!1,errorMessage:e??"Invalid file uploaded"};switch(r.type){case Fe.File:const a=F(mo(e),Ia(t));return r.file==null||r.imageDetails==null?{isValid:!1,errorMessage:e??"Invalid file uploaded"}:a({...r.file,...r.imageDetails});case Fe.ImageUrl:case Fe.VideoUrl:return Ht(r.url)}},po=500,fo=new Date("2016-08-09"),go=new Date,bo={id:{label:"Id",validator:Y},profilePicUrl:{label:"Profile Pic Url",saveToLocalStorage:!0,discord:{display:Rr("click to open")},validator:Y},profilePicFile:{label:"Profile picture",defaultValue:null,swaggerSchema:{type:"string",format:"binary"},saveToLocalStorage:!0,validator:Xt({Api:Y,UI:F(nt("You need to upload an image"),Ia(Nt.profilePic))})},name:{label:"Name",defaultValue:"",discord:{display:W},helpText:"Your IN-GAME character name",validator:F(J(2),fe(100))},bio:{label:"Bio",defaultValue:"",discord:{display:W},validator:F(J(2),fe(po))},platforms:{label:"Platforms",defaultValue:[],swaggerSchema:{type:"array",items:{type:"number"}},discord:{display:(t,e)=>pe(t,e.map(ls))},validator:le(1)},startedPlaying:{label:"Date that you started playing",defaultValue:ts(new Date),swaggerSchema:{type:"string",items:{format:"date-time"}},discord:{label:"Started playing",display:os},validator:F(uo(fo),ho(go))},buildTechniquesUsed:{label:"Build techniques used",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},validator:le(1)},communityAffiliations:{label:"Community affiliations",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Dr({dbCall:t=>_a().community().read(t),mapValue:t=>t.name??"??"})},helpText:"Are you unable to find a community? Ask the community to add it on this site, or add it yourself on the community form.",validator:Y},labels:{label:"Labels",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},validator:F(le(1),Ve(J(1)))},socials:{label:"Socials",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},validator:Ve(F(J(Ur),Ht))},contactDetails:Kt,anonymousUserGuid:Qt},Mr=t=>new Promise(e=>setTimeout(e,t)),yo=500,wo=5,vo={id:{label:"Id",validator:Y},profilePicUrl:{label:"Profile Pic Url",saveToLocalStorage:!0,discord:{display:Rr("click to open")},validator:Y},profilePicFile:{label:"Community Logo",defaultValue:null,swaggerSchema:{type:"string",format:"binary"},saveToLocalStorage:!1,validator:Xt({Api:Y,UI:F(nt("You need to upload an image"),Pr(Nt.profilePic,"You need to upload a valid image"))})},name:{label:"Name",defaultValue:"",discord:{display:W},validator:F(J(2),fe(100))},bio:{label:"Bio",defaultValue:"",discord:{display:W},validator:F(J(2),fe(yo))},bioMediaUrls:{label:"Bio Media",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:is},saveToLocalStorage:!0,validator:Y},bioMediaFiles:{label:"Media upload",swaggerSchema:{$ref:"#/components/schemas/IMediaUpload"},saveToLocalStorage:!1,helpText:`Recommended size (width: ${st.width}, height: ${st.height})`,validator:F(mr(wo),Ve(Pr(Nt.bioMediaPic,"You need to upload a valid image")))},homeGalaxy:{label:"Home Galaxy",defaultValue:"",discord:{display:(t,e)=>W(t,Ae(e).join(""))},onSubmitMapping:t=>t[0],validator:le(1)},coordinates:{label:"Coordinates",defaultValue:"",discord:{display:W},helpText:'You can use the buttons below to input the glyphs or the numbers along with "abcde" on your keyboard.',validator:F(J(fr),fe(fr))},tags:{label:"Tags",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},validator:le(1)},socials:{label:"Socials",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},helpText:'Add links by pressing the "ENTER" key or clicking the arrow on the right hand side. These links will be displayed as icons, if we are missing a customised icon for a link, please feel free to let us know if the feedback page!',validator:F(le(1),mr(10),Ve(F(J(Ur),Ht)))},contactDetails:Kt,anonymousUserGuid:Qt},Bo={id:{label:"Id",validator:Y},name:{label:"Name",defaultValue:"",discord:{display:W},helpText:"The IN-GAME name of the build",validator:F(J(2),fe(100))},mediaUrls:{label:"Media",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:W},saveToLocalStorage:!0,validator:Y},mediaFiles:{label:"Media upload",saveToLocalStorage:!0,swaggerSchema:{type:"array",items:{type:"string",format:"binary"}},helpText:`Recommended size (width: ${st.width}, height: ${st.height})`,validator:Xt({Api:Y,UI:Ve(nt("You need to upload an image"))})},galaxy:{label:"Galaxy",defaultValue:"",discord:{display:W},validator:nt("You need to select a galaxy")},systemName:{label:"System Name",defaultValue:"",discord:{display:W},validator:J(2)},planetName:{label:"Planet Name",defaultValue:"",discord:{display:W},validator:J(2)},coordinates:{label:"Coordinates",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:W},validator:J(2)},buildTechniquesUsed:{label:"Build techniques used",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:pe},helpText:"Please let us know if there is a missing build technique and we will likely add your suggestion",validator:le(1)},builders:{label:"Builders who worked on this build",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Dr({dbCall:t=>_a().builder().read(t),mapValue:t=>t.name??"??"})},helpText:"Are you unable to find a Builder? Ask the Builder to add their profile on this site, or add it yourself on the builder form.",validator:le(1)},contactDetails:Kt,anonymousUserGuid:Qt};var So=Object.defineProperty,No=Object.getOwnPropertyDescriptor,ko=(t,e,r,a)=>{for(var s=a>1?void 0:a?No(e,r):e,n=t.length-1,i;n>=0;n--)(i=t[n])&&(s=(a?i(e,r,s):i(s))||s);return a&&s&&So(e,r,s),s};let qt=class extends $r{_apiUrl;constructor(){const t=Z().getNmsUdApiUrl();super(t),this._apiUrl=t}async submit(t,e,r){const s=await{community:this.createFormFromCommunity(e),builder:this.createFormFromBuilder(e),planetBuild:this.createFormFromPlanetBuild(e)}[t];return s.append(ue.captcha,r),this.submitForm(t,s)}async createFormFromCommunity(t){const{profilePicFile:e,bioMediaFiles:r,...a}=t,s=new FormData;this.addMultiFilesToFormData([e],(c,l)=>s.append(ue.profilePicFile,l));const n=this.addMultiFilesToFormData(r,(c,l)=>s.append(c,l)),i={...a,bioMediaUrls:n},o=this.mapFieldsFromMeta(i,vo);return s.append(ue.data,this.getFormData(o)),s}async createFormFromBuilder(t){const{profilePicFile:e,...r}=t,a=new FormData;this.addMultiFilesToFormData([e],(n,i)=>a.append(ue.profilePicFile,i));const s=this.mapFieldsFromMeta(r,bo);return a.append(ue.data,this.getFormData(s)),a}async createFormFromPlanetBuild(t){const{mediaFiles:e,...r}=t,a=new FormData,s=this.addMultiFilesToFormData(e,(o,c)=>a.append(o,c)),n={...r,mediaUrls:s},i=this.mapFieldsFromMeta(n,Bo);return a.append(ue.data,this.getFormData(i)),a}getFormData(t){return JSON.stringify({...t,anonymousUserGuid:Ce().getAnonymousUserGuid()})}addMultiFilesToFormData(t,e){const r=[];for(const a of Ae(t)){if(a.type!=Fe.File){r.push(a.url);continue}a.file!=null&&e(ue.bioMediaFiles,a.file)}return r}mapFieldsFromMeta(t,e){const r={...t};for(const a in e){if(Object.prototype.hasOwnProperty.call(e,a)==!1)continue;const s=e[a];if(s.onSubmitMapping!=null){const n=r[a]??ae;r[a]=s.onSubmitMapping(n)}}return r}async submitForm(t,e){const r=Er.routes.form.replace(`:${Za.general.segment}`,t),a=`${this._apiUrl}/${r}`;try{const s=await fetch(a,{method:"POST",body:e});if(s.status!=200){const i=await s.text();return $().e("FormApiService submitForm",i),{isSuccess:!1,value:ae,errorMessage:i}}return{isSuccess:!0,value:await s.json(),errorMessage:""}}catch(s){const n=s?.toString?.()??"";return $().e("FormApiService submitForm",n),{isSuccess:!1,value:ae,errorMessage:n}}}};qt=ko([ct()],qt);const To=()=>lt.get(qt);var _o=Object.defineProperty,Io=Object.getOwnPropertyDescriptor,Ao=(t,e,r,a)=>{for(var s=a>1?void 0:a?Io(e,r):e,n=t.length-1,i;n>=0;n--)(i=t[n])&&(s=(a?i(e,r,s):i(s))||s);return a&&s&&_o(e,r,s),s};let zt=class extends $r{constructor(){const t=Z().getNmsUdApiUrl();super(t)}async submitBugReport(t){return this.post(Er.routes.bugReport,t)}};zt=Ao([ct()],zt);const Po=()=>lt.get(zt);var Mo=Object.defineProperty,xo=Object.getOwnPropertyDescriptor,Co=(t,e,r,a)=>{for(var s=a>1?void 0:a?xo(e,r):e,n=t.length-1,i;n>=0;n--)(i=t[n])&&(s=(a?i(e,r,s):i(s))||s);return a&&s&&Mo(e,r,s),s};let Gt=class{_config;constructor(){this._config=Z()}async loadUI(t){xa().addScriptToHead({id:"hcaptcha",url:"https://js.hcaptcha.com/1/api.js",async:!0,defer:!0}),t.dataset.sitekey=this._config.getHCaptchaSiteKey(),t.dataset.theme="dark",t.dataset.size="invisible"}async promptUser(){try{const t=await window.hcaptcha.execute({async:!0});return t==null?{isSuccess:!1,value:"",errorMessage:"Failed to get a captcha token"}:{isSuccess:!0,value:t?.response??"",errorMessage:""}}catch(t){const e=`Failed to prompt for captcha: ${t?.toString?.()}`;return $().e(e),{isSuccess:!1,value:"",errorMessage:t?.toString?.()??"exception occurred during captcha test"}}}async verifyToken(t){let e=new FormData;e.append("response",t),e.append("secret",this._config.getHCaptchaSecret()),$().i("verify captcha token");try{const a=await(await fetch("https://api.hcaptcha.com/siteverify",{method:"POST",body:e})).json();return a==null||a.success===!1?{isSuccess:!1,errorMessage:"Failed to verify captcha token"}:{isSuccess:!0,errorMessage:""}}catch(r){const a=`Failed to verify captcha token: ${r?.toString?.()}`;return $().e(a),{isSuccess:!1,errorMessage:a}}}};Gt=Co([ct()],Gt);const St=()=>lt.get(Gt),$o=t=>g(kt,{bg:"$loContrast",rounded:"$md",border:"1px solid $neutral7",shadow:"$lg",p:"$4",w:"$full",get children(){return[g(lr,{get href(){return t.href},title:"View status",disableRef:!0,additionalClassNames:"noselect",get children(){return g(Ca,{get name(){return t.title},get src(){return t.imgUrl},mr:"$3"})}}),g(lr,{get href(){return t.href},title:"View status",disableRef:!0,additionalClassNames:"noselect",get children(){return g($a,{alignItems:"flex-start",get children(){return[g(De,{size:"sm",textDecoration:"none",color:"white",fontWeight:"$medium",get children(){return t.title}}),g(De,{size:"sm",color:"$neutral11",get children(){return t.descrip}})]}})}}),g(Ue,{variant:"ghost",colorScheme:"accent",size:"sm",ml:"auto",onClick:()=>t.close(),children:"Dismiss"})]}}),Eo=t=>g(Ue,{get"aria-label"(){return t.ariaLabel??"Search"},get class(){return xr("floating-button",t.classNames)},get colorScheme(){return t.colorScheme},fontSize:"large",title:"Submit a bug report",get onClick(){return t.onClick},get children(){return t.icon}}),Oo=t=>{const{isOpen:e,onOpen:r,onClose:a}=Ea();return[g(Eo,{"aria-label":"Submit bug report",colorScheme:"success",icon:"",onClick:r}),g(Cr,{name:"BugReportFAB"}),g(Va,{size:"5xl",get opened(){return e()},onClose:a,get children(){return[g(Oa,{}),g(Ra,{get children(){return[g(Da,{}),g(Ua,{children:"Bug report"}),g(Fa,{get children(){return g(ns,{get submitBugReport(){return t.submitBugReport}})}})]}})]}})]};var Ro=Qa("<div class=h-captcha>");const Xo=t=>{let e;const r=Ce().getForm(t.segment);for(const p of Ae(t.propertyOverrides))for(const f of Object.keys(p)){const B=f,T=r[f],_=p[B];if(_==null)continue;const V=_(T);r[f]=V}const[a,s]=dt(r),[n,i]=dt(!1),[o,c]=dt(j.Loading),l=ur.form[t.segment]?.comingSoon??!1;setTimeout(async()=>{Z().getCaptchaEnabled()==!0&&await St().loadUI(e),c(j.Pending)},500);const w=(p,f)=>{const T=t.formDtoMeta?.[p]?.saveToLocalStorage!==!1;s(_=>{const V={..._,[p]:f};return T&&Ce().setForm(t.segment,V),V})},h=(p,f)=>{let B=ae;if(p.additional==null)return B;for(const T in p.additional){if(Object.prototype.hasOwnProperty.call(p.additional,T)==!1)continue;const _=p.additional[T];B={...B,[T]:_(f)}}return B},v=async()=>{$().i("submitForm");const p=es({data:a(),validationObj:t.formDtoMeta,includeLabelInErrMsgs:!0}).filter(L=>L.isValid===!1);if(p.length>0){te.show({status:"danger",title:"Validation errors",description:"There are some problems that need fixing!"}),p.filter(L=>L.errorMessage!=null).map(L=>$().e(L.errorMessage)),i(!0);return}const f="submit-notification-id";te.show({id:f,title:`Submitting ${pr(t.segment)}`,description:"Uploading details and verifying the data",persistent:!0,closable:!1,loading:!0}),c(j.Loading);let B="test1000080001test";if(Z().getCaptchaEnabled()==!0){const L=await St().promptUser();if(L.isSuccess==!1){te.show({status:"danger",title:"Captcha failed!",description:"The captcha was cancelled or failed to load, please try again."}),c(j.Success);return}B=L.value}const[T,_]=await Promise.all([Mr(Z().isProd()?0:2e3),To().submit(t.segment,a(),B)]);if(_.isSuccess===!1){te.update({id:f,status:"danger",title:"Something went wrong!",description:"Unable to confirm that your data was submitted correctly. Please either try submitting again or reach out to one of the NMSUD organisers",closable:!0,duration:1e4}),c(j.Success);return}const V=_.value.name,ee={title:V,value:_.value.id,image:_.value.iconUrl};Ce().addSubmission(t.segment,ee),te.update({id:f,status:"success",title:"Form submitted successfully",description:"Thank you for your submission! We will verify your submission as soon as possible",duration:1e4});const Me=[Z().getNmsUdFormWebUrl(),"/#",ur.status.path];te.show({render:L=>g($o,hr(L,{get href(){return Me.join("")},get imgUrl(){return _.value.iconUrl??Ya.sidebarLogo},title:"View the status of your submission here:",get descrip(){return g(De,{get children(){return[dr(()=>pr(t.segment)),": '",V,"'"]}})}})),persistent:!0}),P(),c(j.Success)},P=()=>{i(!1),s(p=>{const f={...p};for(const B in t.formDtoMeta)if(Object.prototype.hasOwnProperty.call(t.formDtoMeta,B)){const T=t.formDtoMeta[B];T.defaultValue!==void 0?f[B]=T.defaultValue:f[B]=void 0}return Ce().setForm(t.segment,f),f})},x=async p=>{$().i("submitBugReport");const f="bug-notification-id";if(te.show({id:f,title:"Submitting Bug report",description:"Uploading details and verifying the data",persistent:!0,closable:!1,loading:!0}),c(j.Loading),Z().getCaptchaEnabled()==!0){const _=await St().promptUser();if(_.isSuccess==!1){te.show({status:"danger",title:"Captcha failed!",description:"The captcha was cancelled or failed to load, please try again."}),c(j.Success);return}p.captcha=_.value}const[B,T]=await Promise.all([Mr(Z().isProd()?0:2e3),Po().submitBugReport(p)]);debugger;if(T.isSuccess===!1){te.update({id:f,status:"danger",title:"Something went wrong!",description:"Unable to confirm that your data was submitted correctly. Please either try submitting again or reach out to one of the NMSUD organisers",closable:!0,duration:1e4}),c(j.Success);return}te.update({id:f,status:"success",title:"Report submitted successfully",description:"Thank you for your bug report!",duration:1e4}),c(j.Success)},M=(p,f)=>g(ss,{get colSpan(){return p.gridItemColumnSize},get rowSpan(){return p.gridItemRowSize??as.xsmol},children:f});return[g(Wa,{get text(){return t.title}}),g(ht,{when:l,get children(){return g(La,{mt:"2em",status:"warning",variant:"subtle",borderBottomRadius:"0",justifyContent:"center",class:"card-alert",get children(){return[g(qa,{mr:"$2_5"}),g(za,{get children(){return g(De,{children:"This form is under construction. Submissions made before the page has been made available are likely to be deleted."})}})]}})}}),g(Ka,{get class(){return xr("form",{"alert-visible":l})},get children(){return[g(Cr,{name:"FormBuilder"}),g(rs,{get children(){return g(Ga,{get each(){return Object.keys(t.mappings)},children:p=>{const f=t.mappings[p],B=f.component,T=t.formDtoMeta?.[p];return T==null?M(f,g(Ha,{border:"1px solid red",borderRadius:"1em",height:"100%",get children(){return g(De,{color:"red",textAlign:"center",p:"2em",get children(){return["Item mapping '",p,"'' does not exist on '",dr(()=>t.id),"'"]}})}})):M(f,g(B,hr(()=>h(f,a()),{get id(){return`${t.id}-${p}`},get label(){return T.label},get value(){return a()[p]},get helpText(){return T.helpText},get placeholder(){return f.placeholder},get validation(){return T.validator},get showValidationMessages(){return n()},onChange:_=>w(p,_)})))}})}}),g(ht,{get when(){return o()===j.Error},get children(){return g(kt,{mt:"1em",spacing:"$4",justifyContent:"center",get children(){return g(Xa,{colorScheme:"danger",children:"Something went wrong when submitting your data"})}})}}),g(kt,{mt:"1em",spacing:"$4",justifyContent:"center",get children(){return[(()=>{var p=Ro();return ja(f=>e=f,p),p})(),g(Ue,{class:"no-focus",variant:"solid",get loading(){return o()===j.Loading},onClick:v,children:"Submit"}),g(Ue,{class:"no-focus",variant:"outline",colorScheme:"warning",onClick:P,children:"Clear"}),g(ht,{get when(){return!Z().isProd()},get children(){return g(Ue,{class:"no-focus",variant:"outline",colorScheme:"danger",onClick:()=>{$().i(`${t.segment} form - details so far`,a())},children:"Log object to console"})}})]}})]}}),g(Oo,{submitBugReport:x})]},jo=t=>{const e=t.name?.split?.(".")?.pop?.()??".png";return new Promise((r,a)=>{const s=new FileReader;s.onload=async n=>{const i=new Image;if(n.target==null||n.target.result==null){a("e.target.result is null");return}i.src=n.target.result,await i.decode(),r({name:t.name,type:t.type,width:i.width,height:i.height,fileSize:t.size,fileExtension:e})},s.onerror=n=>a(n),s.readAsDataURL(t)})},Ko={userDefault:250,backgroundDelay:1e3};export{Ko as A,bo as B,vo as C,Xo as F,zo as L,Fe as M,$e as P,go as a,po as b,cs as c,fo as d,wo as e,ls as f,yo as g,jo as h,Bo as i,fr as j,Ur as m,Go as p};
