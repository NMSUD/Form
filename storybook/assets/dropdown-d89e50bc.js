import{D as Kr}from"./image-d51ea353.js";import{n as Ae,s as Jr,a as jr,d as $t,m as se,i as Pe,h as Qe,o as Yr,q as Zr,v as Mt,j as ea,k as ta,w as ra,c as aa,l as na,g as Ut}from"./imageValidation-683bb56a.js";import{i as rr,a as ar,b as sa}from"./dateHelper-42e3f96b.js";import{j as ia,k as oa,m as ca,F as la,Q as ua,R as da,W as ha,X as ma,a as pa,f as fa,h as Dt,Y as Wt,Z as ga,_ as ba,$ as ya,a0 as wa,a1 as va,a2 as Ba,b as Na,c as ka}from"./debugNode-a24c225f.js";import{g as G}from"./logService-f99c2c6c.js";import{m as Vt,a as Ee,s as Ta}from"./textValidation-48b0264a.js";import{c as _a,e as Lt,b as k,S as be,F as Ft}from"./store-3f3d1d83.js";import{u as Ia}from"./useValidation-4ccae39f.js";import{H as Sa}from"./helpIconTooltip-8b6048b3.js";var ve=(t=>(t[t.PSX=0]="PSX",t[t.XBX=1]="XBX",t[t.Steam=2]="Steam",t[t.Apple=3]="Apple",t))(ve||{});const Aa=t=>{switch(t){case 0:return"Playstation";case 1:return"Xbox";case 2:return"Steam";case 3:return"Apple"}return"Unknown"},Xi=t=>{const r={[ve[0]]:0,[ve[1]]:1,[ve[2]]:2,[ve[3]]:3,[0 .toString()]:0,[1 .toString()]:1,[2 .toString()]:2,[3 .toString()]:3}[t];return r??2};var nr=(t=>(t[t.pending=0]="pending",t[t.changesNeeded=1]="changesNeeded",t[t.approved=2]="approved",t[t.approvedAndProcessed=3]="approvedAndProcessed",t[t.denied=4]="denied",t))(nr||{});const ye={},we=t=>({table:t.repo,create:async e=>{try{return{isSuccess:!0,value:await t.repo.create({...e,approvalStatus:nr.pending,...ye}),errorMessage:""}}catch(r){const a=`error occurred while reading record from database. ex: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:ye,errorMessage:a}}},read:async e=>{try{const r=await t.repo.read(e);if(r==null)throw`read${t.logName} - Record not found for (${e})`;return{isSuccess:!0,value:r,errorMessage:""}}catch(r){const a=`error occurred while creating record in database. ex: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:ye,errorMessage:a}}},readAll:async()=>{try{return{isSuccess:!0,value:await t.repo.getAll(),errorMessage:""}}catch(e){const r=`error occurred while fetching all records in database. ex: ${e?.toString?.()}`;return G().e(r),{isSuccess:!1,value:ye,errorMessage:r}}},update:async(e,r)=>{try{return await t.repo.update(e,{...r,...ye}),{isSuccess:!0,errorMessage:""}}catch(a){const s=`error occurred while updating record in database. ex: ${a?.toString?.()}`;return G().e(s),{isSuccess:!1,errorMessage:s}}}}),Pa=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.filter({"builder.id":e}).select(["id","builder.id","builder.name","builder.profilePicUrl","community.id","community.name","community.profilePicUrl"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getCommunityBuilderRecordByBuilderId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:[],errorMessage:a}}},Ea=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.filter({"community.id":e}).select(["id","builder.id","builder.name","builder.profilePicUrl","community.id","community.name","community.profilePicUrl"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getCommunityBuilderRecordByCommunityId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:[],errorMessage:a}}},xa=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.communityBuilder.summarize({summaries:{numBuilders:{count:"*"}},filter:{"community.id":e}})).summaries[0].numBuilders,errorMessage:""}}catch(r){const a=`getNumberOfBuildersByCommunityId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:-1,errorMessage:a}}},Ca=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.filter({"builder.id":e}).select(["id","builder.id","builder.name","planetBuild.id","planetBuild.name"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getPlanetBuildByBuilderId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:[],errorMessage:a}}},Oa=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.filter({"planetBuild.id":e}).select(["id","builder.id","builder.name","planetBuild.id","planetBuild.name"]).getAll()).map(a=>a),errorMessage:""}}catch(r){const a=`getPlanetBuildByPlanetBuildId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:[],errorMessage:a}}},Ra=t=>async e=>{try{return{isSuccess:!0,value:(await t.db.planetBuildBuilder.summarize({summaries:{numBuilds:{count:"*"}},filter:{"builder.id":e}})).summaries[0].numBuilds,errorMessage:""}}catch(r){const a=`getNumberOfBuildsByBuilderId: ${r?.toString?.()}`;return G().e(a),{isSuccess:!1,value:-1,errorMessage:a}}},sr=async(t,e,r)=>await e({name:t,setAttributes:()=>{}}),W={KIND:"xata.trace.kind",VERSION:"xata.sdk.version",TABLE:"xata.table",HTTP_REQUEST_ID:"http.request_id",HTTP_STATUS_CODE:"http.status_code",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_USER_AGENT:"http.user_agent",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_ROUTE:"http.route",HTTP_TARGET:"http.target",CLOUDFLARE_RAY_ID:"cf.ray"};function ir(t){return t!=null}function Q(t){return t.filter(ir)}function or(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>ir(e)))}function Nt(t){try{return t instanceof Blob}catch{return!1}}function p(t){return!!t&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof Date)&&!Nt(t)}function N(t){return t!=null}function v(t){return N(t)&&typeof t=="string"}function cr(t){return N(t)&&Array.isArray(t)&&t.every(v)}function lr(t){return N(t)&&typeof t=="number"}function $a(t){if(lr(t))return t;if(v(t)){const e=Number(t);if(!Number.isNaN(e))return e}}function Ma(t){try{return btoa(t)}catch{return Buffer.from(t).toString("base64")}}function ur(t,e){const r={...t};for(const[a,s]of Object.entries(e))p(s)&&p(r[a])?r[a]=ur(r[a],s):r[a]=s;return r}function kt(t,e){const r=[];for(let a=0;a<t.length;a+=e)r.push(t.slice(a,a+e));return r}async function Ua(t){return new Promise(e=>setTimeout(e,t))}function Da(t){let e;const r=new Promise(a=>{e=setTimeout(()=>{a()},t)});return{cancel:()=>clearTimeout(e),promise:r}}function Tt(t,e){const r=(a,s)=>a.then(n=>e(s).then(i=>(n.push(i),n)));return t.reduce(r,Promise.resolve([]))}function Ge(){try{if(N(process)&&N(process.env))return{apiKey:{}.XATA_API_KEY??Ke(),databaseURL:{}.XATA_DATABASE_URL??Je(),branch:{}.XATA_BRANCH??je(),deployPreview:{}.XATA_PREVIEW,deployPreviewBranch:{}.XATA_PREVIEW_BRANCH,vercelGitCommitRef:{}.VERCEL_GIT_COMMIT_REF,vercelGitRepoOwner:{}.VERCEL_GIT_REPO_OWNER}}catch{}try{if(p(Deno)&&p(Deno.env))return{apiKey:Deno.env.get("XATA_API_KEY")??Ke(),databaseURL:Deno.env.get("XATA_DATABASE_URL")??Je(),branch:Deno.env.get("XATA_BRANCH")??je(),deployPreview:Deno.env.get("XATA_PREVIEW"),deployPreviewBranch:Deno.env.get("XATA_PREVIEW_BRANCH"),vercelGitCommitRef:Deno.env.get("VERCEL_GIT_COMMIT_REF"),vercelGitRepoOwner:Deno.env.get("VERCEL_GIT_REPO_OWNER")}}catch{}return{apiKey:Ke(),databaseURL:Je(),branch:je(),deployPreview:void 0,deployPreviewBranch:void 0,vercelGitCommitRef:void 0,vercelGitRepoOwner:void 0}}function Wa(){try{if(p(process)&&p(process.env)&&{}.XATA_ENABLE_BROWSER!==void 0)return{}.XATA_ENABLE_BROWSER==="true"}catch{}try{if(p(Deno)&&p(Deno.env)&&Deno.env.get("XATA_ENABLE_BROWSER")!==void 0)return Deno.env.get("XATA_ENABLE_BROWSER")==="true"}catch{}try{return XATA_ENABLE_BROWSER===!0||XATA_ENABLE_BROWSER==="true"}catch{return}}function Ke(){try{return XATA_API_KEY}catch{return}}function Je(){try{return XATA_DATABASE_URL}catch{return}}function je(){try{return XATA_BRANCH}catch{return}}function Va(){try{const{databaseURL:t}=Ge();return t}catch{return}}function La(){try{const{apiKey:t}=Ge();return t}catch{return}}function Fa(){try{const{branch:t}=Ge();return t}catch{return}}function qa({org:t,branch:e}){return`preview-${t}-${e}`}function Xa(){try{const{deployPreview:t,deployPreviewBranch:e,vercelGitCommitRef:r,vercelGitRepoOwner:a}=Ge();if(e)return e;switch(t){case"vercel":{if(!r||!a){console.warn("XATA_PREVIEW=vercel but VERCEL_GIT_COMMIT_REF or VERCEL_GIT_REPO_OWNER is not valid");return}return qa({org:a,branch:r})}}return}catch{return}}var _t=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},ue=(t,e,r)=>(_t(t,e,"read from private field"),r?r.call(t):e.get(t)),xe=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Ye=(t,e,r,a)=>(_t(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),za=(t,e,r)=>(_t(t,e,"access private method"),r),Be,he,Xe,nt,dr;const Ga=5*60*1e3;function Ha(t){const e=typeof fetch<"u"?fetch:void 0,r=typeof globalThis<"u"?globalThis.fetch:void 0,a=t??e??r;if(!a)throw new Error("Couldn't find a global `fetch`. Pass a fetch implementation explicitly.");return a}class Qa{constructor(e=10){xe(this,nt),xe(this,Be,void 0),xe(this,he,void 0),xe(this,Xe,void 0),Ye(this,he,[]),Ye(this,Xe,e),this.running=0,this.started=0}setFetch(e){Ye(this,Be,e)}getFetch(){if(!ue(this,Be))throw new Error("Fetch not set");return ue(this,Be)}request(e,r){const a=new Date,s=this.getFetch(),n=async(i=!1)=>{const{promise:o,cancel:c}=Da(Ga),l=await Promise.race([s(e,r),o.then(()=>null)]).finally(c);if(!l)throw new Error("Request timed out");if(l.status===429){const g=$a(l.headers?.get("x-ratelimit-reset"))??1;return await Ua(g*1e3),await n(!0)}if(i){const g=new Date().getTime()-a.getTime();console.warn(`A request to Xata hit branch rate limits, was retried and stalled for ${g}ms`)}return l};return za(this,nt,dr).call(this,async()=>await n())}}Be=new WeakMap;he=new WeakMap;Xe=new WeakMap;nt=new WeakSet;dr=function(t){const e=new Promise(r=>ue(this,he).push(r)).finally(()=>{this.started--,this.running++}).then(()=>t()).finally(()=>{this.running--;const r=ue(this,he).shift();r!==void 0&&(this.started++,r())});if(this.running+this.started<ue(this,Xe)){const r=ue(this,he).shift();r!==void 0&&(this.started++,r())}return e};function Te(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}async function Ka(t,e){const r=t.getReader();let a;for(;!(a=await r.read()).done;)e(a.value)}function Ja(t){let e,r,a,s=!1;return function(i){e===void 0?(e=i,r=0,a=-1):e=Ya(e,i);const o=e.length;let c=0;for(;r<o;){s&&(e[r]===10&&(c=++r),s=!1);let l=-1;for(;r<o&&l===-1;++r)switch(e[r]){case 58:a===-1&&(a=r-c);break;case 13:s=!0;case 10:l=r;break}if(l===-1)break;t(e.subarray(c,l),a),c=r,a=-1}c===o?e=void 0:c!==0&&(e=e.subarray(c),r-=c)}}function ja(t,e,r){let a=qt();const s=new TextDecoder;return function(i,o){if(i.length===0)r?.(a),a=qt();else if(o>0){const c=s.decode(i.subarray(0,o)),l=o+(i[o+1]===32?2:1),g=s.decode(i.subarray(l));switch(c){case"data":a.data=a.data?a.data+`
`+g:g;break;case"event":a.event=g;break;case"id":t(a.id=g);break;case"retry":const h=parseInt(g,10);isNaN(h)||e(a.retry=h);break}}}}function Ya(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function qt(){return{data:"",event:"",id:"",retry:void 0}}const st="text/event-stream",Xt="last-event-id";function Za(t,{signal:e,headers:r,onopen:a,onmessage:s,onclose:n,onerror:i,fetch:o,...c}){return new Promise((l,g)=>{const h={...r};h.accept||(h.accept=st);let b;function T(){b.abort()}e?.addEventListener("abort",()=>{T(),l()});const P=o??fetch,_=a??en;async function E(){b=new AbortController;try{const x=await P(t,{...c,headers:h,signal:b.signal});await _(x),await Ka(x.body,Ja(ja(S=>{S?h[Xt]=S:delete h[Xt]},S=>{},s))),n?.(),T(),l()}catch{}}E()})}function en(t){const e=t.headers?.get("content-type");if(!e?.startsWith(st))throw new Error(`Expected content-type to be ${st}, Actual: ${e}`)}const It="0.28.4";class tn extends Error{constructor(e,r){super(e,r)}}class Ze extends tn{constructor(e,r,a){super(zt(r)),this.status=e,this.errors=hr(r)?r.errors:[{message:zt(r),status:e}],this.requestId=a,r instanceof Error&&(this.stack=r.stack,this.cause=r.cause)}toString(){const e=super.toString();return`[${this.status}] (${this.requestId??"Unknown"}): ${e}`}}function hr(t){return p(t)&&Array.isArray(t.errors)}function rn(t){return p(t)&&v(t.message)}function zt(t){return t instanceof Error?t.message:v(t)?t:rn(t)?t.message:hr(t)?"Bulk operation failed":"Unexpected error"}const an={production:{main:"https://api.xata.io",workspaces:"https://{workspaceId}.{region}.xata.sh"},staging:{main:"https://api.staging-xata.dev",workspaces:"https://{workspaceId}.{region}.staging-xata.dev"},dev:{main:"https://api.dev-xata.dev",workspaces:"https://{workspaceId}.{region}.dev-xata.dev"},local:{main:"http://localhost:6001",workspaces:"http://{workspaceId}.{region}.localhost:6001"}};function nn(t){return v(t)&&Object.keys(an).includes(t)}function sn(t){if(!v(t))return null;const e={production:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.xata\.sh.*/),staging:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.staging-xata\.dev.*/),dev:t.match(/(?:https:\/\/)?([^.]+)(?:\.([^.]+))\.dev-xata\.dev.*/),local:t.match(/(?:https?:\/\/)?([^.]+)(?:\.([^.]+))\.localhost:(\d+)/)},[r,a]=Object.entries(e).find(([,s])=>s!==null)??[];return!nn(r)||!a?null:{workspace:a[1],region:a[2],host:r}}const Gt=new Qa,it=(t,e={},r={})=>{const a=Object.entries(e).reduce((o,[c,l])=>l==null?o:{...o,[c]:l},{}),s=new URLSearchParams(a).toString(),n=s.length>0?`?${s}`:"",i=Object.entries(r).reduce((o,[c,l])=>({...o,[c]:encodeURIComponent(String(l??"")).replace("%3A",":")}),{});return t.replace(/\{\w*\}/g,o=>i[o.slice(1,-1)])+n};function mr({method:t,endpoint:e,path:r,workspacesApiUrl:a,apiUrl:s,pathParams:n={}}){if(e==="dataPlane"){let i=v(a)?`${a}${r}`:a(r,n);if(t.toUpperCase()==="PUT"&&["/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file","/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}"].includes(r)){const{host:c}=sn(i)??{};switch(c){case"production":i=i.replace("xata.sh","upload.xata.sh");break;case"staging":i=i.replace("staging-xata.dev","upload.staging-xata.dev");break;case"dev":i=i.replace("dev-xata.dev","upload.dev-xata.dev");break}}const o=v(n.workspace)?i.replace("{workspaceId}",String(n.workspace)):i;return v(n.region)?o.replace("{region}",String(n.region)):o}return`${s}${r}`}function on(t){const e=/.*:\/\/(?<host>[^/]+).*/,{groups:r}=e.exec(t)??{};return r?.host?{Host:r.host}:{}}async function cn(t,e){if(!N(t))return;if(Nt(t)||typeof t.text=="function")return t;const{"Content-Type":r}=e??{};return String(r).toLowerCase()==="application/json"&&p(t)?JSON.stringify(t):t}const pr=Te();async function fr({url:t,method:e,body:r,headers:a,pathParams:s,queryParams:n,fetch:i,apiKey:o,endpoint:c,apiUrl:l,workspacesApiUrl:g,trace:h,signal:b,clientID:T,sessionID:P,clientName:_,xataAgentExtra:E,fetchOptions:x={},rawResponse:S=!1}){return Gt.setFetch(i),await h(`${e.toUpperCase()} ${t}`,async({setAttributes:M})=>{const U=mr({method:e,endpoint:c,path:t,workspacesApiUrl:g,pathParams:s,apiUrl:l}),ae=it(U,n,s),K=ae.includes("localhost")?ae.replace(/^[^.]+\.[^.]+\./,"http://"):ae;M({[W.HTTP_URL]:K,[W.HTTP_TARGET]:it(t,n,s)});const He=Q([["client","TS_SDK"],["version",It],N(_)?["service",_]:void 0,...Object.entries(E??{})]).map(([ne,Qr])=>`${ne}=${Qr}`).join("; "),Ot=or({"Accept-Encoding":"identity","Content-Type":"application/json","X-Xata-Client-ID":T??pr,"X-Xata-Session-ID":P??Te(),"X-Xata-Agent":He,...a,...on(ae),Authorization:`Bearer ${o}`}),D=await Gt.request(K,{...x,method:e.toUpperCase(),body:await cn(r,Ot),headers:Ot,signal:b}),{host:Gr,protocol:Hr}=un(D.url),Se=D.headers?.get("x-request-id")??void 0;M({[W.KIND]:"http",[W.HTTP_REQUEST_ID]:Se,[W.HTTP_STATUS_CODE]:D.status,[W.HTTP_HOST]:Gr,[W.HTTP_SCHEME]:Hr?.replace(":",""),[W.CLOUDFLARE_RAY_ID]:D.headers?.get("cf-ray")??void 0});const Rt=D.headers?.get("x-xata-message");if(Rt&&console.warn(Rt),D.status===204)return{};if(D.status===429)throw new Ze(D.status,"Rate limit exceeded",Se);try{const ne=S?await D.blob():await D.json();if(D.ok)return ne;throw new Ze(D.status,ne,Se)}catch(ne){throw new Ze(D.status,ne,Se)}},{[W.HTTP_METHOD]:e.toUpperCase(),[W.HTTP_ROUTE]:t})}function ln({url:t,method:e,body:r,headers:a,pathParams:s,queryParams:n,fetch:i,apiKey:o,endpoint:c,apiUrl:l,workspacesApiUrl:g,onMessage:h,onError:b,onClose:T,signal:P,clientID:_,sessionID:E,clientName:x,xataAgentExtra:S}){const M=mr({method:e,endpoint:c,path:t,workspacesApiUrl:g,pathParams:s,apiUrl:l}),U=it(M,n,s),ae=U.includes("localhost")?U.replace(/^[^.]+\./,"http://"):U;Za(ae,{method:e,body:JSON.stringify(r),fetch:i,signal:P,headers:{"X-Xata-Client-ID":_??pr,"X-Xata-Session-ID":E??Te(),"X-Xata-Agent":Q([["client","TS_SDK"],["version",It],N(x)?["service",x]:void 0,...Object.entries(S??{})]).map(([K,He])=>`${K}=${He}`).join("; "),...a,Authorization:`Bearer ${o}`,"Content-Type":"application/json"},onmessage(K){h?.(JSON.parse(K.data))},onerror(K){b?.(JSON.parse(K.data))},onclose(){T?.()}})}function un(t){try{const{host:e,protocol:r}=new URL(t);return{host:e,protocol:r}}catch{return{}}}const d=async t=>fr({...t,endpoint:"dataPlane"}),dn=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/apply",method:"post",...t,signal:e}),hn=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/status",method:"get",...t,signal:e}),mn=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/jobs/{jobId}",method:"get",...t,signal:e}),pn=(t,e)=>d({url:"/db/{dbBranchName}/pgroll/migrations",method:"get",...t,signal:e}),fn=(t,e)=>d({url:"/dbs/{dbName}",method:"get",...t,signal:e}),St=(t,e)=>d({url:"/db/{dbBranchName}",method:"get",...t,signal:e}),gn=(t,e)=>d({url:"/db/{dbBranchName}",method:"put",...t,signal:e}),bn=(t,e)=>d({url:"/db/{dbBranchName}",method:"delete",...t,signal:e}),yn=(t,e)=>d({url:"/db/{dbBranchName}/schema",method:"get",...t,signal:e}),wn=(t,e)=>d({url:"/db/{dbBranchName}/copy",method:"post",...t,signal:e}),vn=(t,e)=>d({url:"/db/{dbBranchName}/metadata",method:"put",...t,signal:e}),Bn=(t,e)=>d({url:"/db/{dbBranchName}/metadata",method:"get",...t,signal:e}),Nn=(t,e)=>d({url:"/db/{dbBranchName}/stats",method:"get",...t,signal:e}),kn=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"get",...t,signal:e}),Tn=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"post",...t,signal:e}),_n=(t,e)=>d({url:"/dbs/{dbName}/gitBranches",method:"delete",...t,signal:e}),In=(t,e)=>d({url:"/dbs/{dbName}/resolveBranch",method:"get",...t,signal:e}),Sn=(t,e)=>d({url:"/db/{dbBranchName}/migrations",method:"get",...t,signal:e}),An=(t,e)=>d({url:"/db/{dbBranchName}/migrations/plan",method:"post",...t,signal:e}),Pn=(t,e)=>d({url:"/db/{dbBranchName}/migrations/execute",method:"post",...t,signal:e}),En=(t,e)=>d({url:"/dbs/{dbName}/migrations/query",method:"post",...t,signal:e}),xn=(t,e)=>d({url:"/dbs/{dbName}/migrations",method:"post",...t,signal:e}),Cn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}",method:"get",...t,signal:e}),On=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}",method:"patch",...t,signal:e}),Rn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/commits",method:"post",...t,signal:e}),$n=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/compare",method:"post",...t,signal:e}),Mn=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/merge",method:"get",...t,signal:e}),Un=(t,e)=>d({url:"/dbs/{dbName}/migrations/{mrNumber}/merge",method:"post",...t,signal:e}),Dn=(t,e)=>d({url:"/db/{dbBranchName}/schema/history",method:"post",...t,signal:e}),Wn=(t,e)=>d({url:"/db/{dbBranchName}/schema/compare",method:"post",...t,signal:e}),Vn=(t,e)=>d({url:"/db/{dbBranchName}/schema/compare/{branchName}",method:"post",...t,signal:e}),Ln=(t,e)=>d({url:"/db/{dbBranchName}/schema/update",method:"post",...t,signal:e}),Fn=(t,e)=>d({url:"/db/{dbBranchName}/schema/preview",method:"post",...t,signal:e}),qn=(t,e)=>d({url:"/db/{dbBranchName}/schema/apply",method:"post",...t,signal:e}),Xn=(t,e)=>d({url:"/db/{dbBranchName}/schema/push",method:"post",...t,signal:e}),zn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"put",...t,signal:e}),Gn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"delete",...t,signal:e}),Hn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}",method:"patch",...t,signal:e}),Qn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/schema",method:"get",...t,signal:e}),Kn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/schema",method:"put",...t,signal:e}),Jn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns",method:"get",...t,signal:e}),jn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns",method:"post",...t,signal:e}),Yn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"get",...t,signal:e}),Zn=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"patch",...t,signal:e}),es=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/columns/{columnName}",method:"delete",...t,signal:e}),_e=(t,e)=>d({url:"/db/{dbBranchName}/transaction",method:"post",...t,signal:e}),gr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data",method:"post",...t,signal:e}),br=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"get",...t,signal:e}),yr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"put",...t,signal:e}),wr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file/{fileId}",method:"delete",...t,signal:e}),ts=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"get",...t,signal:e}),rs=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"put",...t,signal:e}),as=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}/column/{columnName}/file",method:"delete",...t,signal:e}),vr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"get",...t,signal:e}),Br=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"put",...t,signal:e}),Nr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"patch",...t,signal:e}),kr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"post",...t,signal:e}),Tr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/data/{recordId}",method:"delete",...t,signal:e}),ns=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/bulk",method:"post",...t,signal:e}),_r=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/query",method:"post",...t,signal:e}),Ir=(t,e)=>d({url:"/db/{dbBranchName}/search",method:"post",...t,signal:e}),Sr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/search",method:"post",...t,signal:e}),Ar=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/vectorSearch",method:"post",...t,signal:e}),ss=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/ask",method:"post",...t,signal:e}),Pr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/ask/{sessionId}",method:"post",...t,signal:e}),Er=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/summarize",method:"post",...t,signal:e}),xr=(t,e)=>d({url:"/db/{dbBranchName}/tables/{tableName}/aggregate",method:"post",...t,signal:e}),is=(t,e)=>d({url:"/file/{fileId}",method:"get",...t,signal:e}),os=(t,e)=>d({url:"/file/{fileId}",method:"put",...t,signal:e}),Cr=(t,e)=>d({url:"/db/{dbBranchName}/sql",method:"post",...t,signal:e}),cs={branch:{applyMigration:dn,pgRollStatus:hn,pgRollJobStatus:mn,pgRollMigrationHistory:pn,getBranchList:fn,getBranchDetails:St,createBranch:gn,deleteBranch:bn,copyBranch:wn,updateBranchMetadata:vn,getBranchMetadata:Bn,getBranchStats:Nn,getGitBranchesMapping:kn,addGitBranchesEntry:Tn,removeGitBranchesEntry:_n,resolveBranch:In},migrations:{getSchema:yn,getBranchMigrationHistory:Sn,getBranchMigrationPlan:An,executeBranchMigrationPlan:Pn,getBranchSchemaHistory:Dn,compareBranchWithUserSchema:Wn,compareBranchSchemas:Vn,updateBranchSchema:Ln,previewBranchSchemaEdit:Fn,applyBranchSchemaEdit:qn,pushBranchMigrations:Xn},migrationRequests:{queryMigrationRequests:En,createMigrationRequest:xn,getMigrationRequest:Cn,updateMigrationRequest:On,listMigrationRequestsCommits:Rn,compareMigrationRequest:$n,getMigrationRequestIsMerged:Mn,mergeMigrationRequest:Un},table:{createTable:zn,deleteTable:Gn,updateTable:Hn,getTableSchema:Qn,setTableSchema:Kn,getTableColumns:Jn,addTableColumn:jn,getColumn:Yn,updateColumn:Zn,deleteColumn:es},records:{branchTransaction:_e,insertRecord:gr,getRecord:vr,insertRecordWithID:Br,updateRecordWithID:Nr,upsertRecordWithID:kr,deleteRecord:Tr,bulkInsertTableRecords:ns},files:{getFileItem:br,putFileItem:yr,deleteFileItem:wr,getFile:ts,putFile:rs,deleteFile:as,fileAccess:is,fileUpload:os},searchAndFilter:{queryTable:_r,searchBranch:Ir,searchTable:Sr,vectorSearchTable:Ar,askTable:ss,askTableSession:Pr,summarizeTable:Er,aggregateTable:xr},sql:{sqlQuery:Cr}},f=async t=>fr({...t,endpoint:"controlPlane"}),ls=(t,e)=>f({url:"/oauth/authorize",method:"get",...t,signal:e}),us=(t,e)=>f({url:"/oauth/authorize",method:"post",...t,signal:e}),ds=(t,e)=>f({url:"/user",method:"get",...t,signal:e}),hs=(t,e)=>f({url:"/user",method:"put",...t,signal:e}),ms=(t,e)=>f({url:"/user",method:"delete",...t,signal:e}),ps=(t,e)=>f({url:"/user/keys",method:"get",...t,signal:e}),fs=(t,e)=>f({url:"/user/keys/{keyName}",method:"post",...t,signal:e}),gs=(t,e)=>f({url:"/user/keys/{keyName}",method:"delete",...t,signal:e}),bs=(t,e)=>f({url:"/user/oauth/clients",method:"get",...t,signal:e}),ys=(t,e)=>f({url:"/user/oauth/clients/{clientId}",method:"delete",...t,signal:e}),ws=(t,e)=>f({url:"/user/oauth/tokens",method:"get",...t,signal:e}),vs=(t,e)=>f({url:"/user/oauth/tokens/{token}",method:"delete",...t,signal:e}),Bs=(t,e)=>f({url:"/user/oauth/tokens/{token}",method:"patch",...t,signal:e}),Ns=(t,e)=>f({url:"/workspaces",method:"get",...t,signal:e}),ks=(t,e)=>f({url:"/workspaces",method:"post",...t,signal:e}),Ts=(t,e)=>f({url:"/workspaces/{workspaceId}",method:"get",...t,signal:e}),_s=(t,e)=>f({url:"/workspaces/{workspaceId}",method:"put",...t,signal:e}),Is=(t,e)=>f({url:"/workspaces/{workspaceId}",method:"delete",...t,signal:e}),Ss=(t,e)=>f({url:"/workspaces/{workspaceId}/members",method:"get",...t,signal:e}),As=(t,e)=>f({url:"/workspaces/{workspaceId}/members/{userId}",method:"put",...t,signal:e}),Ps=(t,e)=>f({url:"/workspaces/{workspaceId}/members/{userId}",method:"delete",...t,signal:e}),Es=(t,e)=>f({url:"/workspaces/{workspaceId}/invites",method:"post",...t,signal:e}),xs=(t,e)=>f({url:"/workspaces/{workspaceId}/invites/{inviteId}",method:"patch",...t,signal:e}),Cs=(t,e)=>f({url:"/workspaces/{workspaceId}/invites/{inviteId}",method:"delete",...t,signal:e}),Os=(t,e)=>f({url:"/workspaces/{workspaceId}/invites/{inviteKey}/accept",method:"post",...t,signal:e}),Rs=(t,e)=>f({url:"/workspaces/{workspaceId}/invites/{inviteId}/resend",method:"post",...t,signal:e}),$s=(t,e)=>f({url:"/workspaces/{workspaceId}/clusters",method:"get",...t,signal:e}),Ms=(t,e)=>f({url:"/workspaces/{workspaceId}/clusters",method:"post",...t,signal:e}),Us=(t,e)=>f({url:"/workspaces/{workspaceId}/clusters/{clusterId}",method:"get",...t,signal:e}),Ds=(t,e)=>f({url:"/workspaces/{workspaceId}/clusters/{clusterId}",method:"patch",...t,signal:e}),Ws=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs",method:"get",...t,signal:e}),Vs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"put",...t,signal:e}),Ls=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"delete",...t,signal:e}),Fs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"get",...t,signal:e}),qs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}",method:"patch",...t,signal:e}),Xs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}/rename",method:"post",...t,signal:e}),zs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"get",...t,signal:e}),Gs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"put",...t,signal:e}),Hs=(t,e)=>f({url:"/workspaces/{workspaceId}/dbs/{dbName}/github",method:"delete",...t,signal:e}),Qs=(t,e)=>f({url:"/workspaces/{workspaceId}/regions",method:"get",...t,signal:e}),Ks={oAuth:{getAuthorizationCode:ls,grantAuthorizationCode:us,getUserOAuthClients:bs,deleteUserOAuthClient:ys,getUserOAuthAccessTokens:ws,deleteOAuthAccessToken:vs,updateOAuthAccessToken:Bs},users:{getUser:ds,updateUser:hs,deleteUser:ms},authentication:{getUserAPIKeys:ps,createUserAPIKey:fs,deleteUserAPIKey:gs},workspaces:{getWorkspacesList:Ns,createWorkspace:ks,getWorkspace:Ts,updateWorkspace:_s,deleteWorkspace:Is,getWorkspaceMembersList:Ss,updateWorkspaceMemberRole:As,removeWorkspaceMember:Ps},invites:{inviteWorkspaceMember:Es,updateWorkspaceMemberInvite:xs,cancelWorkspaceMemberInvite:Cs,acceptWorkspaceMemberInvite:Os,resendWorkspaceMemberInvite:Rs},xbcontrolOther:{listClusters:$s,createCluster:Ms,getCluster:Us,updateCluster:Ds},databases:{getDatabaseList:Ws,createDatabase:Vs,deleteDatabase:Ls,getDatabaseMetadata:Fs,updateDatabaseMetadata:qs,renameDatabase:Xs,getDatabaseGithubSettings:zs,updateDatabaseGithubSettings:Gs,deleteDatabaseGithubSettings:Hs,listRegions:Qs}};ur(cs,Ks);class Ie{}function Js(t){return t.flatMap(e=>Object.entries(e).map(([r,a])=>{if(r==="trim"){const{left:s=0,top:n=0,right:i=0,bottom:o=0}=a;return`${r}=${[n,i,o,s].join(";")}`}if(r==="gravity"&&typeof a=="object"){const{x:s=.5,y:n=.5}=a;return`${r}=${[s,n].join("x")}`}return`${r}=${a}`})).join(",")}function Ce(t,...e){if(!N(t))return;const r=Js(e),{hostname:a,pathname:s,search:n}=new URL(t),i=s.split("/"),o=i.findIndex(h=>h==="transform"),l=`/transform/${[(o>=0?i.splice(o,2):[])[1],r].filter(N).join(",")}`,g=i.join("/");return`https://${a}${l}${g}${n}`}class Y{constructor(e){this.id=e.id,this.name=e.name,this.mediaType=e.mediaType,this.base64Content=e.base64Content,this.enablePublicUrl=e.enablePublicUrl,this.signedUrlTimeout=e.signedUrlTimeout,this.uploadUrlTimeout=e.uploadUrlTimeout,this.size=e.size,this.version=e.version,this.url=e.url,this.signedUrl=e.signedUrl,this.uploadUrl=e.uploadUrl,this.attributes=e.attributes}static fromBuffer(e,r={}){const a=e.toString("base64");return new Y({...r,base64Content:a})}toBuffer(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return Buffer.from(this.base64Content,"base64")}static fromArrayBuffer(e,r={}){const a=new Uint8Array(e);return this.fromUint8Array(a,r)}toArrayBuffer(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content);return new ArrayBuffer(e.length)}static fromUint8Array(e,r={}){let a="";for(let n=0;n<e.byteLength;n++)a+=String.fromCharCode(e[n]);const s=btoa(a);return new Y({...r,base64Content:s})}toUint8Array(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return r}static async fromBlob(e,r={}){const a=r.name??e.name,s=e.type,n=await e.arrayBuffer();return this.fromArrayBuffer(n,{...r,name:a,mediaType:s})}toBlob(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');const e=atob(this.base64Content),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return new Blob([r],{type:this.mediaType})}static fromString(e,r={}){const a=btoa(e);return new Y({...r,base64Content:a})}toString(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return atob(this.base64Content)}static fromBase64(e,r={}){return new Y({...r,base64Content:e})}toBase64(){if(!this.base64Content)throw new Error('File content is not available, please select property "base64Content" when querying the file');return this.base64Content}transform(...e){return{url:Ce(this.url,...e),signedUrl:Ce(this.signedUrl,...e),metadataUrl:Ce(this.url,...e,{format:"json"}),metadataSignedUrl:Ce(this.signedUrl,...e,{format:"json"})}}}const Ht=async t=>{if(!N(t))return null;const{id:e,name:r,mediaType:a,base64Content:s,enablePublicUrl:n,signedUrlTimeout:i,uploadUrlTimeout:o}=await t;return or({id:e,name:r||void 0,mediaType:a,base64Content:s,enablePublicUrl:n,signedUrlTimeout:i,uploadUrlTimeout:o})};function ze(t){if(!N(t))return;if(!p(t))return t;const e=Object.fromEntries(Object.entries(t).reduce((r,[a,s])=>{if(!N(s))return r;if(Array.isArray(s)){const n=s.map(i=>ze(i)).filter(i=>N(i));return n.length===0?r:[...r,[a,n]]}if(p(s)){const n=ze(s);return N(n)?[...r,[a,n]]:r}return[...r,[a,s]]},[]));return Object.keys(e).length>0?e:void 0}function js(t){if(!N(t)||v(t))return t;try{return JSON.stringify(t)}catch{return t}}function Ys(t){try{return JSON.parse(t)}catch{return t}}var Or=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},H=(t,e,r)=>(Or(t,e,"read from private field"),r?r.call(t):e.get(t)),Rr=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},$r=(t,e,r,a)=>(Or(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),ee,j;class Qt{constructor(e,r,a=[]){Rr(this,ee,void 0),$r(this,ee,e),this.meta=r,this.records=new ot(this,a)}async nextPage(e,r){return H(this,ee).getPaginated({pagination:{size:e,offset:r,after:this.meta.page.cursor}})}async previousPage(e,r){return H(this,ee).getPaginated({pagination:{size:e,offset:r,before:this.meta.page.cursor}})}async startPage(e,r){return H(this,ee).getPaginated({pagination:{size:e,offset:r,start:this.meta.page.cursor}})}async endPage(e,r){return H(this,ee).getPaginated({pagination:{size:e,offset:r,end:this.meta.page.cursor}})}hasNextPage(){return this.meta.page.more}}ee=new WeakMap;const et=1e3,Kt=20;function Zs(t){return N(t)&&(N(t.start)||N(t.end)||N(t.after)||N(t.before))}const ei=class oe extends Array{constructor(...e){super(...oe.parseConstructorParams(...e)),Rr(this,j,void 0),$r(this,j,p(e[0]?.meta)?e[0]:{meta:{page:{cursor:"",more:!1}},records:[]})}static parseConstructorParams(...e){if(e.length===1&&typeof e[0]=="number")return new Array(e[0]);if(e.length<=2&&p(e[0]?.meta)&&Array.isArray(e[1]??[])){const r=e[1]??e[0].records??[];return new Array(...r)}return new Array(...e)}toArray(){return new Array(...this)}toSerializable(){return JSON.parse(this.toString())}toString(){return JSON.stringify(this.toArray())}map(e,r){return this.toArray().map(e,r)}async nextPage(e,r){const a=await H(this,j).nextPage(e,r);return new oe(a)}async previousPage(e,r){const a=await H(this,j).previousPage(e,r);return new oe(a)}async startPage(e,r){const a=await H(this,j).startPage(e,r);return new oe(a)}async endPage(e,r){const a=await H(this,j).endPage(e,r);return new oe(a)}hasNextPage(){return H(this,j).meta.page.more}};j=new WeakMap;let ot=ei;var At=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},m=(t,e,r)=>(At(t,e,"read from private field"),r?r.call(t):e.get(t)),Oe=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},tt=(t,e,r,a)=>(At(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Jt=(t,e,r)=>(At(t,e,"access private method"),r),$,C,B,$e,ct;const ti=class q{constructor(e,r,a,s){Oe(this,$e),Oe(this,$,void 0),Oe(this,C,void 0),Oe(this,B,{filter:{}}),this.meta={page:{cursor:"start",more:!0,size:Kt}},this.records=new ot(this,[]),tt(this,$,r),e?tt(this,C,e):tt(this,C,this);const n=ai(a,s);m(this,B).filter=a.filter??n?.filter??{},m(this,B).filter.$any=a.filter?.$any??n?.filter?.$any,m(this,B).filter.$all=a.filter?.$all??n?.filter?.$all,m(this,B).filter.$not=a.filter?.$not??n?.filter?.$not,m(this,B).filter.$none=a.filter?.$none??n?.filter?.$none,m(this,B).sort=a.sort??n?.sort,m(this,B).columns=a.columns??n?.columns,m(this,B).consistency=a.consistency??n?.consistency,m(this,B).pagination=a.pagination??n?.pagination,m(this,B).cache=a.cache??n?.cache,m(this,B).fetchOptions=a.fetchOptions??n?.fetchOptions,this.any=this.any.bind(this),this.all=this.all.bind(this),this.not=this.not.bind(this),this.filter=this.filter.bind(this),this.sort=this.sort.bind(this),this.none=this.none.bind(this),Object.defineProperty(this,"table",{enumerable:!1}),Object.defineProperty(this,"repository",{enumerable:!1})}getQueryOptions(){return m(this,B)}key(){const{columns:e=[],filter:r={},sort:a=[],pagination:s={}}=m(this,B),n=JSON.stringify({columns:e,filter:r,sort:a,pagination:s});return Ma(n)}any(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new q(m(this,C),m(this,$),{filter:{$any:r}},m(this,B))}all(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new q(m(this,C),m(this,$),{filter:{$all:r}},m(this,B))}not(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new q(m(this,C),m(this,$),{filter:{$not:r}},m(this,B))}none(...e){const r=e.map(a=>a.getQueryOptions().filter??{});return new q(m(this,C),m(this,$),{filter:{$none:r}},m(this,B))}filter(e,r){if(arguments.length===1){const a=Object.entries(e??{}).map(([n,i])=>({[n]:Jt(this,$e,ct).call(this,n,i)})),s=Q([m(this,B).filter?.$all].flat().concat(a));return new q(m(this,C),m(this,$),{filter:{$all:s}},m(this,B))}else{const a=N(e)&&N(r)?[{[e]:Jt(this,$e,ct).call(this,e,r)}]:void 0,s=Q([m(this,B).filter?.$all].flat().concat(a));return new q(m(this,C),m(this,$),{filter:{$all:s}},m(this,B))}}sort(e,r="asc"){const s=[...[m(this,B).sort??[]].flat(),{column:e,direction:r}];return new q(m(this,C),m(this,$),{sort:s},m(this,B))}select(e){return new q(m(this,C),m(this,$),{columns:e},m(this,B))}getPaginated(e={}){const r=new q(m(this,C),m(this,$),e,m(this,B));return m(this,C).query(r)}async*[Symbol.asyncIterator](){for await(const[e]of this.getIterator({batchSize:1}))yield e}async*getIterator(e={}){const{batchSize:r=1}=e;let a=await this.getPaginated({...e,pagination:{size:r,offset:0}}),s=a.hasNextPage();for(yield a.records;s;)a=await a.nextPage(),s=a.hasNextPage(),yield a.records}async getMany(e={}){const{pagination:r={},...a}=e,{size:s=Kt,offset:n}=r,i=s<=et?s:et;let o=await this.getPaginated({...a,pagination:{size:i,offset:n}});const c=[...o.records];for(;o.hasNextPage()&&c.length<s;)o=await o.nextPage(),c.push(...o.records);return o.hasNextPage()&&e.pagination?.size===void 0&&console.trace("Calling getMany does not return all results. Paginate to get all results or call getAll."),new ot(o,c.slice(0,s))}async getAll(e={}){const{batchSize:r=et,...a}=e,s=[];for await(const n of this.getIterator({...a,batchSize:r}))s.push(...n);return s}async getFirst(e={}){return(await this.getMany({...e,pagination:{size:1}}))[0]??null}async getFirstOrThrow(e={}){const r=await this.getMany({...e,pagination:{size:1}});if(r[0]===void 0)throw new Error("No results found.");return r[0]}async summarize(e={}){const{summaries:r,summariesFilter:a,...s}=e,n=new q(m(this,C),m(this,$),s,m(this,B));return m(this,C).summarizeTable(n,r,a)}cache(e){return new q(m(this,C),m(this,$),{cache:e},m(this,B))}nextPage(e,r){return this.startPage(e,r)}previousPage(e,r){return this.startPage(e,r)}startPage(e,r){return this.getPaginated({pagination:{size:e,offset:r}})}endPage(e,r){return this.getPaginated({pagination:{size:e,offset:r,before:"end"}})}hasNextPage(){return this.meta.page.more}};$=new WeakMap;C=new WeakMap;B=new WeakMap;$e=new WeakSet;ct=function(t,e){const r=m(this,$).schema?.columns.find(({name:a})=>a===t)?.type;return r==="multiple"&&(v(e)||cr(e))?{$includes:e}:r==="link"&&p(e)&&v(e.id)?e.id:e};let ri=ti;function ai(t,e){return Zs(t.pagination)?{...e,sort:void 0,filter:void 0}:e}function ni(t){return p(t)&&v(t?.id)}function si(t){return p(t)&&v(t.name)}function R(t){return Array.isArray(t)?t.every(e=>typeof e=="string"?!0:typeof e=="object"?si(e):!1):!1}function ii(t){return v(t)}function Mr(t){return p(t)&&Object.entries(t).every(([e,r])=>e==="*"?r==="random":r==="asc"||r==="desc")}function oi(t){return p(t)&&!Mr(t)&&t.column!==void 0}function lt(t){if(ii(t))return{[t]:"asc"};if(Array.isArray(t))return t.map(e=>lt(e));if(Mr(t))return t;if(oi(t))return{[t.column]:t.direction??"asc"};throw new Error(`Invalid sort filter: ${t}`)}var Pt=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},u=(t,e,r)=>(Pt(t,e,"read from private field"),r?r.call(t):e.get(t)),A=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},te=(t,e,r,a)=>(Pt(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),y=(t,e,r)=>(Pt(t,e,"access private method"),r),w,I,V,fe,me,O,ut,Ur,ce,Ne,Me,dt,Ue,ht,De,mt,We,pt,Ve,ft,gt,Dr,bt,Wr,yt,Vr,L,X,re,ge;const Et=1e3;class jt extends ri{constructor(e){super(null,{name:e.table,schema:e.schemaTables?.find(a=>a.name===e.table)},{}),A(this,ut),A(this,ce),A(this,Me),A(this,Ue),A(this,De),A(this,We),A(this,Ve),A(this,gt),A(this,bt),A(this,yt),A(this,L),A(this,re),A(this,w,void 0),A(this,I,void 0),A(this,V,void 0),A(this,fe,void 0),A(this,me,void 0),A(this,O,void 0),te(this,w,e.table),te(this,V,e.db),te(this,fe,e.pluginOptions.cache),te(this,me,e.schemaTables),te(this,I,()=>({...e.pluginOptions,sessionID:Te()}));const r=e.pluginOptions.trace??sr;te(this,O,async(a,s,n={})=>r(a,s,{...n,[W.TABLE]:u(this,w),[W.KIND]:"sdk-operation",[W.VERSION]:It}))}async create(e,r,a,s){return u(this,O).call(this,"create",async()=>{const n=de(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await y(this,Me,dt).call(this,e,{ifVersion:n,createOnly:!0}),o=R(r)?r:["*"];return await this.read(i,o)}if(v(e)&&p(r)){if(e==="")throw new Error("The id can't be empty");const i=R(a)?a:void 0;return await y(this,ce,Ne).call(this,e,r,i,{createOnly:!0,ifVersion:n})}if(p(e)&&v(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=R(r)?r:void 0;return await y(this,ce,Ne).call(this,e.id,{...e,id:void 0},i,{createOnly:!0,ifVersion:n})}if(p(e)){const i=R(r)?r:void 0;return y(this,ut,Ur).call(this,e,i)}throw new Error("Invalid arguments for create method")})}async read(e,r){return u(this,O).call(this,"read",async()=>{const a=R(r)?r:["*"];if(Array.isArray(e)){if(e.length===0)return[];const n=e.map(c=>J(c)),o=(await this.getAll({filter:{id:{$any:Q(n)}},columns:a})).reduce((c,l)=>(c[l.id]=l,c),{});return n.map(c=>o[c??""]??null)}const s=J(e);if(s)try{const n=await vr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),recordId:s},queryParams:{columns:a},...u(this,I).call(this)}),i=await y(this,L,X).call(this);return F(u(this,V),i,u(this,w),n,a)}catch(n){if(p(n)&&n.status===404)return null;throw n}return null})}async readOrThrow(e,r){return u(this,O).call(this,"readOrThrow",async()=>{const a=await this.read(e,r);if(Array.isArray(a)){const s=Q(e.filter((n,i)=>a[i]===null).map(n=>J(n)));if(s.length>0)throw new Error(`Could not find records with ids: ${s.join(", ")}`);return a}if(a===null){const s=J(e)??"unknown";throw new Error(`Record with id ${s} not found`)}return a})}async update(e,r,a,s){return u(this,O).call(this,"update",async()=>{const n=de(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await this.read(e,["id"]),o=e.filter((g,h)=>i[h]!==null);await y(this,De,mt).call(this,o,{ifVersion:n,upsert:!1});const c=R(r)?r:["*"];return await this.read(e,c)}try{if(v(e)&&p(r)){const i=R(a)?a:void 0;return await y(this,Ue,ht).call(this,e,r,i,{ifVersion:n})}if(p(e)&&v(e.id)){const i=R(r)?r:void 0;return await y(this,Ue,ht).call(this,e.id,{...e,id:void 0},i,{ifVersion:n})}}catch(i){if(i.status===422)return null;throw i}throw new Error("Invalid arguments for update method")})}async updateOrThrow(e,r,a,s){return u(this,O).call(this,"updateOrThrow",async()=>{const n=await this.update(e,r,a,s);if(Array.isArray(n)){const i=Q(e.filter((o,c)=>n[c]===null).map(o=>J(o)));if(i.length>0)throw new Error(`Could not find records with ids: ${i.join(", ")}`);return n}if(n===null){const i=J(e)??"unknown";throw new Error(`Record with id ${i} not found`)}return n})}async createOrUpdate(e,r,a,s){return u(this,O).call(this,"createOrUpdate",async()=>{const n=de(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];await y(this,De,mt).call(this,e,{ifVersion:n,upsert:!0});const i=R(r)?r:["*"];return await this.read(e,i)}if(v(e)&&p(r)){if(e==="")throw new Error("The id can't be empty");const i=R(a)?a:void 0;return await y(this,We,pt).call(this,e,r,i,{ifVersion:n})}if(p(e)&&v(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=R(a)?a:void 0;return await y(this,We,pt).call(this,e.id,{...e,id:void 0},i,{ifVersion:n})}if(!N(e)&&p(r))return await this.create(r,a);if(p(e)&&!N(e.id))return await this.create(e,r);throw new Error("Invalid arguments for createOrUpdate method")})}async createOrReplace(e,r,a,s){return u(this,O).call(this,"createOrReplace",async()=>{const n=de(r,a,s);if(Array.isArray(e)){if(e.length===0)return[];const i=await y(this,Me,dt).call(this,e,{ifVersion:n,createOnly:!1}),o=R(r)?r:["*"];return await this.read(i,o)}if(v(e)&&p(r)){if(e==="")throw new Error("The id can't be empty");const i=R(a)?a:void 0;return await y(this,ce,Ne).call(this,e,r,i,{createOnly:!1,ifVersion:n})}if(p(e)&&v(e.id)){if(e.id==="")throw new Error("The id can't be empty");const i=R(a)?a:void 0;return await y(this,ce,Ne).call(this,e.id,{...e,id:void 0},i,{createOnly:!1,ifVersion:n})}if(!N(e)&&p(r))return await this.create(r,a);if(p(e)&&!N(e.id))return await this.create(e,r);throw new Error("Invalid arguments for createOrReplace method")})}async delete(e,r){return u(this,O).call(this,"delete",async()=>{if(Array.isArray(e)){if(e.length===0)return[];const a=e.map(i=>{if(v(i))return i;if(v(i.id))return i.id;throw new Error("Invalid arguments for delete method")}),s=R(r)?r:["*"],n=await this.read(e,s);return await y(this,gt,Dr).call(this,a),n}if(v(e))return y(this,Ve,ft).call(this,e,r);if(p(e)&&v(e.id))return y(this,Ve,ft).call(this,e.id,r);throw new Error("Invalid arguments for delete method")})}async deleteOrThrow(e,r){return u(this,O).call(this,"deleteOrThrow",async()=>{const a=await this.delete(e,r);if(Array.isArray(a)){const s=Q(e.filter((n,i)=>a[i]===null).map(n=>J(n)));if(s.length>0)throw new Error(`Could not find records with ids: ${s.join(", ")}`);return a}else if(a===null){const s=J(e)??"unknown";throw new Error(`Record with id ${s} not found`)}return a})}async search(e,r={}){return u(this,O).call(this,"search",async()=>{const{records:a,totalCount:s}=await Sr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},body:{query:e,fuzziness:r.fuzziness,prefix:r.prefix,highlight:r.highlight,filter:r.filter,boosters:r.boosters,page:r.page,target:r.target},...u(this,I).call(this)}),n=await y(this,L,X).call(this);return{records:a.map(i=>F(u(this,V),n,u(this,w),i,["*"])),totalCount:s}})}async vectorSearch(e,r,a){return u(this,O).call(this,"vectorSearch",async()=>{const{records:s,totalCount:n}=await Ar({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},body:{column:e,queryVector:r,similarityFunction:a?.similarityFunction,size:a?.size,filter:a?.filter},...u(this,I).call(this)}),i=await y(this,L,X).call(this);return{records:s.map(o=>F(u(this,V),i,u(this,w),o,["*"])),totalCount:n}})}async aggregate(e,r){return u(this,O).call(this,"aggregate",async()=>await xr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},body:{aggs:e,filter:r},...u(this,I).call(this)}))}async query(e){return u(this,O).call(this,"query",async()=>{const r=await y(this,yt,Vr).call(this,e);if(r)return new Qt(e,r.meta,r.records);const a=e.getQueryOptions(),{meta:s,records:n}=await _r({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},body:{filter:ze(a.filter),sort:a.sort!==void 0?lt(a.sort):void 0,page:a.pagination,columns:a.columns??["*"],consistency:a.consistency},fetchOptions:a.fetchOptions,...u(this,I).call(this)}),i=await y(this,L,X).call(this),o=n.map(c=>F(u(this,V),i,u(this,w),c,a.columns??["*"]));return await y(this,bt,Wr).call(this,e,s,o),new Qt(e,s,o)})}async summarizeTable(e,r,a){return u(this,O).call(this,"summarize",async()=>{const s=e.getQueryOptions(),n=await Er({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},body:{filter:ze(s.filter),sort:s.sort!==void 0?lt(s.sort):void 0,columns:s.columns,consistency:s.consistency,page:s.pagination?.size!==void 0?{size:s.pagination?.size}:void 0,summaries:r,summariesFilter:a},...u(this,I).call(this)}),i=await y(this,L,X).call(this);return{...n,summaries:n.summaries.map(o=>F(u(this,V),i,u(this,w),o,s.columns??[]))}})}ask(e,r){const a=r?.sessionId?{message:e}:{question:e},s={pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),sessionId:r?.sessionId},body:{...a,rules:r?.rules,searchType:r?.searchType,search:r?.searchType==="keyword"?r?.search:void 0,vectorSearch:r?.searchType==="vector"?r?.vectorSearch:void 0},...u(this,I).call(this)};if(r?.onMessage)ln({endpoint:"dataPlane",url:"/db/{dbBranchName}/tables/{tableName}/ask/{sessionId}",method:"POST",onMessage:n=>{r.onMessage?.({answer:n.text,records:n.records})},...s});else return Pr(s)}}w=new WeakMap;I=new WeakMap;V=new WeakMap;fe=new WeakMap;me=new WeakMap;O=new WeakMap;ut=new WeakSet;Ur=async function(t,e=["*"]){const r=await y(this,re,ge).call(this,t),a=await gr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w)},queryParams:{columns:e},body:r,...u(this,I).call(this)}),s=await y(this,L,X).call(this);return F(u(this,V),s,u(this,w),a,e)};ce=new WeakSet;Ne=async function(t,e,r=["*"],{createOnly:a,ifVersion:s}){if(!t)return null;const n=await y(this,re,ge).call(this,e),i=await Br({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),recordId:t},body:n,queryParams:{createOnly:a,columns:r,ifVersion:s},...u(this,I).call(this)}),o=await y(this,L,X).call(this);return F(u(this,V),o,u(this,w),i,r)};Me=new WeakSet;dt=async function(t,{createOnly:e,ifVersion:r}){const a=await Tt(t,async i=>{const o=await y(this,re,ge).call(this,i);return{insert:{table:u(this,w),record:o,createOnly:e,ifVersion:r}}}),s=kt(a,Et),n=[];for(const i of s){const{results:o}=await _e({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:i},...u(this,I).call(this)});for(const c of o)c.operation==="insert"?n.push(c.id):n.push(null)}return n};Ue=new WeakSet;ht=async function(t,e,r=["*"],{ifVersion:a}){if(!t)return null;const{id:s,...n}=await y(this,re,ge).call(this,e);try{const i=await Nr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),recordId:t},queryParams:{columns:r,ifVersion:a},body:n,...u(this,I).call(this)}),o=await y(this,L,X).call(this);return F(u(this,V),o,u(this,w),i,r)}catch(i){if(p(i)&&i.status===404)return null;throw i}};De=new WeakSet;mt=async function(t,{ifVersion:e,upsert:r}){const a=await Tt(t,async({id:i,...o})=>{const c=await y(this,re,ge).call(this,o);return{update:{table:u(this,w),id:i,ifVersion:e,upsert:r,fields:c}}}),s=kt(a,Et),n=[];for(const i of s){const{results:o}=await _e({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:i},...u(this,I).call(this)});for(const c of o)c.operation==="update"?n.push(c.id):n.push(null)}return n};We=new WeakSet;pt=async function(t,e,r=["*"],{ifVersion:a}){if(!t)return null;const s=await kr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),recordId:t},queryParams:{columns:r,ifVersion:a},body:e,...u(this,I).call(this)}),n=await y(this,L,X).call(this);return F(u(this,V),n,u(this,w),s,r)};Ve=new WeakSet;ft=async function(t,e=["*"]){if(!t)return null;try{const r=await Tr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:u(this,w),recordId:t},queryParams:{columns:e},...u(this,I).call(this)}),a=await y(this,L,X).call(this);return F(u(this,V),a,u(this,w),r,e)}catch(r){if(p(r)&&r.status===404)return null;throw r}};gt=new WeakSet;Dr=async function(t){const e=kt(Q(t).map(r=>({delete:{table:u(this,w),id:r}})),Et);for(const r of e)await _e({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:r},...u(this,I).call(this)})};bt=new WeakSet;Wr=async function(t,e,r){await u(this,fe)?.set(`query_${u(this,w)}:${t.key()}`,{date:new Date,meta:e,records:r})};yt=new WeakSet;Vr=async function(t){const e=`query_${u(this,w)}:${t.key()}`,r=await u(this,fe)?.get(e);if(!r)return null;const a=u(this,fe)?.defaultQueryTTL??-1,{cache:s=a}=t.getQueryOptions();return s<0||r.date.getTime()+s<Date.now()?null:r};L=new WeakSet;X=async function(){if(u(this,me))return u(this,me);const{schema:t}=await St({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},...u(this,I).call(this)});return te(this,me,t.tables),t.tables};re=new WeakSet;ge=async function(t){const r=(await y(this,L,X).call(this)).find(s=>s.name===u(this,w));if(!r)throw new Error(`Table ${u(this,w)} not found in schema`);const a={};for(const[s,n]of Object.entries(t)){if(s==="xata")continue;switch(r.columns.find(o=>o.name===s)?.type){case"link":{a[s]=ni(n)?n.id:n;break}case"datetime":{a[s]=n instanceof Date?n.toISOString():n;break}case"file":a[s]=await Ht(n);break;case"file[]":a[s]=await Tt(n,o=>Ht(o));break;case"json":a[s]=js(n);break;default:a[s]=n}}return a};const F=(t,e,r,a,s)=>{const n={},{xata:i,...o}=a??{};Object.assign(n,o);const{columns:c}=e.find(({name:h})=>h===r)??{};c||console.error(`Table ${r} not found in schema`);for(const h of c??[]){if(!ci(s,h))continue;const b=n[h.name];switch(h.type){case"datetime":{const T=b!==void 0?new Date(b):null;T!==null&&isNaN(T.getTime())?console.error(`Failed to parse date ${b} for field ${h.name}`):n[h.name]=T;break}case"link":{const T=h.link?.table;if(!T)console.error(`Failed to parse link for field ${h.name}`);else if(p(b)){const P=s.reduce((_,E)=>{if(E===h.name)return[..._,"*"];if(v(E)&&E.startsWith(`${h.name}.`)){const[,...x]=E.split(".");return[..._,x.join(".")]}return _},[]);n[h.name]=F(t,e,T,b,P)}else n[h.name]=null;break}case"file":n[h.name]=N(b)?new Y(b):null;break;case"file[]":n[h.name]=b?.map(T=>new Y(T))??null;break;case"json":n[h.name]=Ys(b);break;default:n[h.name]=b??null,h.notNull===!0&&b===null&&console.error(`Parse error, column ${h.name} is non nullable and value resolves null`);break}}const l={...n},g=i!==void 0?{...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}:void 0;l.read=function(h){return t[r].read(l.id,h)},l.update=function(h,b,T){const P=R(b)?b:["*"],_=de(b,T);return t[r].update(l.id,h,P,{ifVersion:_})},l.replace=function(h,b,T){const P=R(b)?b:["*"],_=de(b,T);return t[r].createOrReplace(l.id,h,P,{ifVersion:_})},l.delete=function(){return t[r].delete(l.id)},g!==void 0&&(l.xata=Object.freeze(g)),l.getMetadata=function(){return l.xata},l.toSerializable=function(){return JSON.parse(JSON.stringify(l))},l.toString=function(){return JSON.stringify(l)};for(const h of["read","update","replace","delete","getMetadata","toSerializable","toString"])Object.defineProperty(l,h,{enumerable:!1});return Object.freeze(l),l};function J(t){if(v(t))return t;if(p(t)&&v(t.id))return t.id}function ci(t,e){return t.includes("*")?!0:t.filter(r=>v(r)&&r.startsWith(e.name)).length>0}function de(...t){for(const e of t)if(p(e)&&lr(e.ifVersion))return e.ifVersion}var Lr=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Z=(t,e,r)=>(Lr(t,e,"read from private field"),r?r.call(t):e.get(t)),li=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},ui=(t,e,r,a)=>(Lr(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),z;class di{constructor(e={}){li(this,z,void 0),ui(this,z,new Map),this.capacity=e.max??500,this.defaultQueryTTL=e.defaultQueryTTL??60*1e3}async getAll(){return Object.fromEntries(Z(this,z))}async get(e){return Z(this,z).get(e)??null}async set(e,r){if(await this.delete(e),Z(this,z).set(e,r),Z(this,z).size>this.capacity){const a=Z(this,z).keys().next().value;await this.delete(a)}}async delete(e){Z(this,z).delete(e)}async clear(){return Z(this,z).clear()}}z=new WeakMap;var Fr=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},ie=(t,e,r)=>(Fr(t,e,"read from private field"),r?r.call(t):e.get(t)),Yt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},hi=(t,e,r,a)=>(Fr(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),ke,le;class mi extends Ie{constructor(e){super(),Yt(this,ke,{}),Yt(this,le,void 0),hi(this,le,e)}build(e){const r=new Proxy({},{get:(s,n)=>{if(!v(n))throw new Error("Invalid table name");return ie(this,ke)[n]===void 0&&(ie(this,ke)[n]=new jt({db:r,pluginOptions:e,table:n,schemaTables:ie(this,le)})),ie(this,ke)[n]}}),a=ie(this,le)?.map(({name:s})=>s)??[];for(const s of a)r[s]=new jt({db:r,pluginOptions:e,table:s,schemaTables:ie(this,le)});return r}}ke=new WeakMap;le=new WeakMap;class pi extends Ie{build(e){return{download:async r=>{const{table:a,record:s,column:n,fileId:i=""}=r??{};return await br({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:a??"",recordId:s??"",columnName:n??"",fileId:i},...e,rawResponse:!0})},upload:async(r,a,s)=>{const{table:n,record:i,column:o,fileId:c=""}=r??{},l=await a,g=s?.mediaType||fi(l),h=l instanceof Y?l.toBlob():l;return await yr({...e,pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:n??"",recordId:i??"",columnName:o??"",fileId:c},body:h,headers:{"Content-Type":g}})},delete:async r=>{const{table:a,record:s,column:n,fileId:i=""}=r??{};return await wr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}",tableName:a??"",recordId:s??"",columnName:n??"",fileId:i},...e})}}}}function fi(t){if(typeof t=="string")return"text/plain";if("mediaType"in t&&t.mediaType!==void 0)return t.mediaType;if(Nt(t))return t.type;try{return t.type}catch{}return"application/octet-stream"}var xt=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Zt=(t,e,r)=>(xt(t,e,"read from private field"),r?r.call(t):e.get(t)),rt=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},qr=(t,e,r,a)=>(xt(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),Re=(t,e,r)=>(xt(t,e,"access private method"),r),pe,Le,wt,Fe,vt;class gi extends Ie{constructor(e,r){super(),this.db=e,rt(this,Le),rt(this,Fe),rt(this,pe,void 0),qr(this,pe,r)}build(e){return{all:async(r,a={})=>{const{records:s,totalCount:n}=await Re(this,Le,wt).call(this,r,a,e),i=await Re(this,Fe,vt).call(this,e);return{totalCount:n,records:s.map(o=>{const{table:c="orphan"}=o.xata;return{table:c,record:F(this.db,i,c,o,["*"])}})}},byTable:async(r,a={})=>{const{records:s,totalCount:n}=await Re(this,Le,wt).call(this,r,a,e),i=await Re(this,Fe,vt).call(this,e),o=s.reduce((c,l)=>{const{table:g="orphan"}=l.xata,h=c[g]??[],b=F(this.db,i,g,l,["*"]);return{...c,[g]:[...h,b]}},{});return{totalCount:n,records:o}}}}}pe=new WeakMap;Le=new WeakSet;wt=async function(t,e,r){const{tables:a,fuzziness:s,highlight:n,prefix:i,page:o}=e??{},{records:c,totalCount:l}=await Ir({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{tables:a,query:t,fuzziness:s,prefix:i,highlight:n,page:o},...r});return{records:c,totalCount:l}};Fe=new WeakSet;vt=async function(t){if(Zt(this,pe))return Zt(this,pe);const{schema:e}=await St({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},...t});return qr(this,pe,e.tables),e.tables};function bi(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Xr(t){let e="{";for(let r=0;r<t.length;r++)r>0&&(e=e+","),t[r]===null||typeof t[r]>"u"?e=e+"NULL":Array.isArray(t[r])?e=e+Xr(t[r]):t[r]instanceof Buffer?e+="\\\\x"+t[r].toString("hex"):e+=bi(qe(t[r]));return e=e+"}",e}function qe(t){if(!N(t))return null;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return Xr(t);if(p(t))return JSON.stringify(t);try{return t.toString()}catch{return t}}function yi(t,e){if(v(t))return{statement:t,params:e?.map(r=>qe(r))};if(cr(t))return{statement:t.reduce((a,s,n)=>a+s+(n<(e?.length??0)?"$"+(n+1):""),""),params:e?.map(a=>qe(a))};if(p(t)){const{statement:r,params:a,consistency:s}=t;return{statement:r,params:a?.map(n=>qe(n)),consistency:s}}throw new Error("Invalid query")}class wi extends Ie{build(e){return async(r,...a)=>{const{statement:s,params:n,consistency:i}=yi(r,a),{records:o,warning:c}=await Cr({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{statement:s,params:n,consistency:i},...e});return{records:o,warning:c}}}}class vi extends Ie{build(e){return{run:async r=>await _e({pathParams:{workspace:"{workspaceId}",dbBranchName:"{dbBranch}",region:"{region}"},body:{operations:r},...e})}}}var Ct=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},er=(t,e,r)=>(Ct(t,e,"read from private field"),r?r.call(t):e.get(t)),at=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Bi=(t,e,r,a)=>(Ct(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),tr=(t,e,r)=>(Ct(t,e,"access private method"),r);const zr=t=>{var e,r,a,s,n,i;return i=class{constructor(o={},c){at(this,r),at(this,s),at(this,e,void 0);const l=tr(this,r,a).call(this,o);Bi(this,e,l);const g={...tr(this,s,n).call(this,l),cache:l.cache,host:l.host},h=new mi(c).build(g),b=new gi(h,c).build(g),T=new vi().build(g),P=new wi().build(g),_=new pi().build(g);this.db=h,this.search=b,this.transactions=T,this.sql=P,this.files=_;for(const[E,x]of Object.entries(t??{}))x!==void 0&&(this[E]=x.build(g))}async getConfig(){const o=er(this,e).databaseURL,c=er(this,e).branch;return{databaseURL:o,branch:c}}},e=new WeakMap,r=new WeakSet,a=function(o){const c=o?.enableBrowser??Wa()??!1;if(typeof window<"u"&&typeof Deno>"u"&&!c)throw new Error("You are trying to use Xata from the browser, which is potentially a non-secure environment. If you understand the security concerns, such as leaking your credentials, pass `enableBrowser: true` to the client options to remove this error.");const g=Ha(o?.fetch),h=o?.databaseURL||Va(),b=o?.apiKey||La(),T=o?.cache??new di({defaultQueryTTL:0}),P=o?.trace??sr,_=o?.clientName,E=o?.host??"production",x=o?.xataAgentExtra;if(!b)throw new Error("Option apiKey is required");if(!h)throw new Error("Option databaseURL is required");const S=Fa(),M=Xa(),U=o?.branch||M||S||"main";return M&&U!==M?console.warn(`Ignoring preview branch ${M} because branch option was passed to the client constructor with value ${U}`):S&&U!==S?console.warn(`Ignoring branch ${S} because branch option was passed to the client constructor with value ${U}`):M&&S&&M!==S?console.warn(`Ignoring preview branch ${M} and branch ${S} because branch option was passed to the client constructor with value ${U}`):!M&&!S&&o?.branch===void 0&&console.warn(`No branch was passed to the client constructor. Using default branch ${U}. You can set the branch with the environment variable XATA_BRANCH or by passing the branch option to the client constructor.`),{fetch:g,databaseURL:h,apiKey:b,branch:U,cache:T,trace:P,host:E,clientID:Te(),enableBrowser:c,clientName:_,xataAgentExtra:x}},s=new WeakSet,n=function({fetch:o,apiKey:c,databaseURL:l,branch:g,trace:h,clientID:b,clientName:T,xataAgentExtra:P}){return{fetch:o,apiKey:c,apiUrl:"",workspacesApiUrl:(_,E)=>{const x=E.dbBranchName??E.branch,S=_.replace(/^\/db\/[^/]+/,x!==void 0?`:${g}`:"");return l+S},trace:h,clientID:b,clientName:T,xataAgentExtra:P}},i};class zi extends zr(){}const Ni=[{name:"community",columns:[{name:"profilePicUrl",type:"string"},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"discordWebhookId",type:"string",defaultValue:""},{name:"profilePicFile",type:"file",file:{defaultPublicAccess:!0}},{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"bio",type:"string",notNull:!0,defaultValue:""},{name:"bioMediaUrls",type:"string",notNull:!0,defaultValue:""},{name:"tags",type:"string",notNull:!0,defaultValue:""},{name:"socials",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"bioMediaFiles",type:"file[]","file[]":{defaultPublicAccess:!0}},{name:"homeGalaxy",type:"string",notNull:!0,defaultValue:""},{name:"coordinates",type:"string",notNull:!0,defaultValue:""},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"community",table:"communityBuilder"}]},{name:"builder",columns:[{name:"profilePicUrl",type:"string"},{name:"profilePicFile",type:"file",file:{defaultPublicAccess:!0}},{name:"bio",type:"string",notNull:!0,defaultValue:""},{name:"platforms",type:"string",notNull:!0,defaultValue:""},{name:"buildTechniquesUsed",type:"string",notNull:!0,defaultValue:""},{name:"startedPlaying",type:"datetime",notNull:!0,defaultValue:"2016-08-09T00:00:00.000Z"},{name:"labels",type:"string",notNull:!0,defaultValue:""},{name:"socials",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"discordWebhookId",type:"string",notNull:!0,defaultValue:""},{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"builder",table:"communityBuilder"},{column:"builder",table:"planetBuildBuilder"}]},{name:"communityBuilder",columns:[{name:"community",type:"link",link:{table:"community"}},{name:"builder",type:"link",link:{table:"builder"}}]},{name:"planetBuild",columns:[{name:"name",type:"string",notNull:!0,defaultValue:""},{name:"mediaUrls",type:"string",notNull:!0,defaultValue:""},{name:"mediaFiles",type:"file[]"},{name:"galaxy",type:"string",notNull:!0,defaultValue:""},{name:"systemName",type:"string",notNull:!0,defaultValue:""},{name:"planetName",type:"string",notNull:!0,defaultValue:""},{name:"coordinates",type:"string",notNull:!0,defaultValue:""},{name:"buildTechniquesUsed",type:"string",notNull:!0,defaultValue:""},{name:"contactDetails",type:"string",notNull:!0,defaultValue:""},{name:"discordWebhookId",type:"string",notNull:!0,defaultValue:""},{name:"approvalStatus",type:"int",notNull:!0,defaultValue:"0"},{name:"anonymousUserGuid",type:"string",notNull:!0,defaultValue:""}],revLinks:[{column:"planetBuild",table:"planetBuildBuilder"}]},{name:"planetBuildBuilder",columns:[{name:"planetBuild",type:"link",link:{table:"planetBuild"}},{name:"builder",type:"link",link:{table:"builder"}}]}],ki=zr(),Ti={databaseURL:"https://AssistantNMS-9tmlv0.eu-central-1.xata.sh/db/nmsud-submission"};class _i extends ki{constructor(e){super({...Ti,...e},Ni)}}var Ii=Object.defineProperty,Si=Object.getOwnPropertyDescriptor,Ai=(t,e,r,a)=>{for(var s=a>1?void 0:a?Si(e,r):e,n=t.length-1,i;n>=0;n--)(i=t[n])&&(s=(a?i(e,r,s):i(s))||s);return a&&s&&Ii(e,r,s),s};let Bt=class{_xata;constructor(){const t=oa();this._xata=new _i({apiKey:t.getXataApiKey(),databaseURL:t.getXataDbUrl(),branch:t.getXataFallbackBranch()})}community=()=>we({logName:"Community",repo:this._xata.db.community,files:this._xata.files});builder=()=>we({logName:"Builder",repo:this._xata.db.builder,files:this._xata.files});communityBuilder=()=>({...we({logName:"CommunityBuilder",repo:this._xata.db.communityBuilder,files:this._xata.files}),getByBuilderId:Pa(this._xata),getByCommunityId:Ea(this._xata),getNumberOfBuilders:xa(this._xata)});planetBuild=()=>we({logName:"PlanetBuild",repo:this._xata.db.planetBuild,files:this._xata.files});planetBuildBuilder=()=>({...we({logName:"PlanetBuildBuilder",repo:this._xata.db.planetBuildBuilder,files:this._xata.files}),getByBuilderId:Ca(this._xata),getByPlanetBuildId:Oa(this._xata),getNumberOfBuilds:Ra(this._xata)})};Bt=Ai([ia()],Bt);const Pi=()=>ca.get(Bt),Ei=t=>e=>rr(t,e)?{isValid:!0}:{isValid:!1,errorMessage:`${e} | Minimum date is ${ar(t,"DD MMM YY")}`},xi=t=>e=>rr(e,t)?{isValid:!0}:{isValid:!1,errorMessage:`Maximum date is ${ar(t,"DD MMM YY")}`},Ci=500,Oi=new Date("2016-08-09"),Ri=new Date,Gi={id:{label:"Id",validator:Ae},profilePicUrl:{label:"Profile Pic Url",saveToLocalStorage:!0,discord:{display:Jr("click to open")},validator:Ae},profilePicFile:{label:"Profile picture",defaultValue:null,swaggerSchema:{type:"string",format:"binary"},saveToLocalStorage:!0,validator:jr({Api:Ae,UI:se(aa("You need to upload an image"),ra(Kr.profilePic))})},name:{label:"Name",defaultValue:"",discord:{display:$t},helpText:"Your IN-GAME character name",validator:se(Ee(2),Vt(100))},bio:{label:"Bio",defaultValue:"",discord:{display:$t},validator:se(Ee(2),Vt(Ci))},platforms:{label:"Platforms",defaultValue:[],swaggerSchema:{type:"array",items:{type:"number"}},discord:{display:(t,e)=>Pe(t,e.map(Aa))},validator:Qe(1)},startedPlaying:{label:"Date that you started playing",defaultValue:sa(new Date),swaggerSchema:{type:"string",items:{format:"date-time"}},discord:{label:"Started playing",display:Yr},validator:se(Ei(Oi),xi(Ri))},buildTechniquesUsed:{label:"Build techniques used",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Pe},validator:Qe(1)},communityAffiliations:{label:"Community affiliations",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Zr({dbCall:t=>Pi().community().read(t),mapValue:t=>t.name??"??"})},helpText:"Are you unable to find a community? Ask the community to add it on this site, or add it yourself on the community form.",validator:Ae},labels:{label:"Labels",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Pe},validator:se(Qe(1),Mt(Ee(1)))},socials:{label:"Socials",defaultValue:[],swaggerSchema:{type:"array",items:{type:"string"}},discord:{display:Pe},validator:Mt(se(Ee(na),Ta))},contactDetails:ea,anonymousUserGuid:ta},Hi=t=>{const[e,r]=_a(t.selectedValues??[],{equals:!1}),[a,s]=Ia(t.validation);Lt(()=>{if(t.showValidationMessages===!0){const o=Ut(t.selectedValues);s(o)}},[t.showValidationMessages]),Lt(()=>{r(t.selectedValues??[])});const n=o=>{r(o);const c=Ut(o);t.onChange?.(c),s(c)},i=o=>t.options.find(l=>l.value==o);return k(ka,{get invalid(){return!a().isValid},get children(){return[k(be,{get when(){return t.hideTitle!=!0},get children(){return k(la,{get children(){return k(Sa,{get label(){return t.title},get helpText(){return t.helpText}})}})}}),k(ua,{get multiple(){return t.multiple},get value(){return e()},onChange:n,get children(){return[k(da,{get children(){return[k(ha,{class:"noselect",get children(){return t.placeholder}}),k(ma,{class:"noselect",children:({selectedOptions:o})=>k(pa,{alignItems:"flex-start",get children(){return k(Ft,{each:o,children:c=>{const l=i(c.value);return k(fa,{borderRadius:5,m:"0.125em 0.25em 0.125em 0",get children(){return k(be,{when:l!=null,get fallback(){return k(Dt,{textAlign:"start",get children(){return c.textValue}})},get children(){return[k(be,{get when(){return l.image!=null},get children(){return k(Wt,{get src(){return l.image},get alt(){return l.title},borderRadius:3,height:"1em",width:"1em",mr:"0.5em"})}}),k(Dt,{textAlign:"start",get children(){return l.title}})]}})}})}})}})}),k(ga,{})]}}),k(ba,{class:"noselect",get children(){return k(ya,{get children(){return k(Ft,{get each(){return t.options},children:o=>k(wa,{get value(){return o.value},get disabled(){return o.disabled},get children(){return[k(be,{get when(){return o.image!=null},get children(){return k(Wt,{get src(){return o.image},get alt(){return o.title},borderRadius:5,maxHeight:"2em",maxWidth:"2em",ml:"0.5em"})}}),k(va,{get children(){return o.listTitle??o.title}}),k(Ba,{})]}})})}})}})]}}),k(be,{get when(){return!a().isValid},get children(){return k(Na,{get children(){return a().errorMessage}})}})]}})};export{Gi as B,Hi as D,ve as P,Aa as f,Xi as p};
